<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Career Opportunities at VILOSTUDIOS - Join our animation team">
  <meta name="keywords" content="career, jobs, animation jobs, 2D animation, 3D animation, hiring">
  <title>Career - VILOSTUDIOS</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* Dashboard Design System */
    :root {
      --bg-primary: #0A0A0A;
      --bg-secondary: #1A1A1F;
      --bg-tertiary: rgba(255, 255, 255, 0.03);
      --bg-hover: rgba(255, 255, 255, 0.05);
      
      --border-default: rgba(255, 255, 255, 0.08);
      --border-hover: rgba(255, 255, 255, 0.12);
      --border-input: rgba(255, 255, 255, 0.1);
      
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      
      --accent-orange: #FF6B35;
      --accent-orange-hover: #FF8C42;
      
      --accent-blue: #60A5FA;
      --accent-blue-soft: rgba(96, 165, 250, 0.15);
      --accent-blue-border: rgba(96, 165, 250, 0.3);
      
      --accent-green: #4ADE80;
      --accent-green-soft: rgba(74, 222, 128, 0.15);
      --accent-green-border: rgba(74, 222, 128, 0.3);
      
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 10px;
      --radius-xl: 12px;
      
      --font-xs: 0.6875rem;
      --font-sm: 0.75rem;
      --font-base: 0.8125rem;
      --font-md: 0.875rem;
      --font-lg: 0.9375rem;
      --font-xl: 1rem;
      --font-2xl: 1.125rem;
      
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 0.75rem;
      --spacing-lg: 1rem;
      --spacing-xl: 1.5rem;
      
      --transition-base: 0.2s ease;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
    }
    
    .career-section {
      background: var(--bg-primary);
    }
    
    .career-container {
      background: transparent;
    }
  </style>
</head>
<body>
  <div class="app" style="background: #000;">

    <!-- Video Footer -->
    <div class="video-footer">
      <div class="video-social-links">
        <a href="https://discord.gg/7uU4nHSFwD" target="_blank" rel="noopener noreferrer" aria-label="Discord">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"></path>
          </svg>
        </a>
        <a href="https://x.com/vilostudios" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)" id="x-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
          </svg>
        </a>
        <a href="https://www.youtube.com/@vilostudios" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path>
          </svg>
        </a>
        <a href="https://www.linkedin.com/company/vilostudios" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
          </svg>
        </a>
      </div>
      <div class="video-copyright">© VILOSTUDIOS</div>
    </div>

    <!-- Navigation -->
    <nav class="navigation">
      <div class="nav-logo">
        <a href="index.html" style="display: flex; align-items: center; gap: 0.75rem; text-decoration: none; color: inherit;">
          <img src="src/Logo/BrandLogo.png" alt="VILOSTUDIOS" class="logo-img">
          <span class="logo-text">VILOSTUDIOS</span>
        </a>
      </div>
      <ul class="nav-menu">
        <li><a href="index.html#home" class="nav-link" data-section="home">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text" data-i18n="nav.home">Home</span>
        </a></li>
        <li><a href="index.html#about" class="nav-link" data-section="about">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 5C4 3.89543 4.89543 3 6 3H10.5858C10.851 3 11.1054 3.10536 11.2929 3.29289L13.7071 5.70711C13.8946 5.89464 14.149 6 14.4142 6H18C19.1046 6 20 6.89543 20 8V19C20 20.1046 19.1046 21 18 21H6C4.89543 21 4 20.1046 4 19V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 13H16M8 17H16M8 9H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text" data-i18n="nav.about">About</span>
        </a></li>
        <li><a href="index.html#portfolio" class="nav-link" data-section="portfolio">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 16V8C20.9996 7.64928 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64928 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3.27002 6.96L12 12.01L20.73 6.96" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 22.08V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text" data-i18n="nav.portfolio">Portfolio</span>
        </a></li>
        <li><a href="career.html" class="nav-link active" data-section="career">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 7H4C2.89543 7 2 7.89543 2 9V19C2 20.1046 2.89543 21 4 21H20C21.1046 21 22 20.1046 22 19V9C22 7.89543 21.1046 7 20 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 21V17C16 15.8954 15.1046 15 14 15H10C8.89543 15 8 15.8954 8 17V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 11C13.1046 11 14 10.1046 14 9C14 7.89543 13.1046 7 12 7C10.8954 7 10 7.89543 10 9C10 10.1046 10.8954 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 7V5C8 3.89543 8.89543 3 10 3H14C15.1046 3 16 3.89543 16 5V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text" data-i18n="nav.career">Career</span>
        </a></li>
      </ul>
      <div class="nav-footer">
        <div id="user-profile-nav" class="user-profile-nav" style="display: none;">
          <a href="dashboard/employee/index.html" class="nav-user-button">
            <div class="nav-user-avatar" id="nav-user-avatar">U</div>
            <span class="nav-user-name" id="nav-user-name">User</span>
          </a>
        </div>
        <a href="login.html" class="nav-login-button" id="nav-login-button" title="Recruiters Login">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 5 L12 10 L7 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M12 10 L3 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
            <path d="M15 3 L17 3 C17.5523 3 18 3.44772 18 4 L18 16 C18 16.5523 17.5523 17 17 17 L15 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
          </svg>
        </a>
        <div class="language-switcher">
          <button class="lang-button active" data-lang="en" aria-label="Switch to EN">EN</button>
          <button class="lang-button" data-lang="ja" aria-label="Switch to JP">JP</button>
          <button class="lang-button" data-lang="zh" aria-label="Switch to ZH">ZH</button>
          <button class="lang-button" data-lang="ko" aria-label="Switch to KO">KO</button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" style="padding-top: 120px; background: #000; min-height: 100vh;">
      <section class="section career-section" style="min-height: 100vh; padding: 4rem 4rem;">
        <div class="section-header" style="margin-bottom: 3rem;">
          <div class="section-number">04</div>
          <h2 class="section-title" style="font-size: 3rem; font-weight: 800; margin-bottom: 0.5rem;" data-i18n="career.title">Career</h2>
          <p class="section-subtitle" style="font-size: 1.25rem; color: var(--text-secondary);" data-i18n="career.subtitle">Join Our Animation Team</p>
        </div>

        <div class="career-container" style="max-width: 1800px; margin: 0 auto; padding: 0 var(--spacing-xl);">
          <!-- Sidebar + Main Content Layout -->
          <div class="career-layout">
            <!-- Left Sidebar Filters -->
            <aside class="career-sidebar">
              <!-- Search -->
              <div class="sidebar-section">
                <div class="search-container">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="search-icon">
                    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                    <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <input type="text" id="position-search" class="search-input" placeholder="Search" oninput="handleSearch()">
                </div>
              </div>

              <!-- Categories Filter -->
              <div class="sidebar-section">
                <h3 class="sidebar-title">Department</h3>
                <div class="job-categories-container">
                  <!-- Categories will be dynamically loaded here -->
                </div>
              </div>

              <!-- Employment Type Filter -->
              <div class="sidebar-section">
                <h3 class="sidebar-title">Employment Type</h3>
                <div class="filter-buttons">
                  <button class="filter-btn" onclick="filterByEmploymentType('all')" data-type="all">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    All Types
                  </button>
                  <button class="filter-btn" onclick="filterByEmploymentType('permanent')" data-type="permanent">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                      <path d="M16 2V6M8 2V6M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                      <path d="M8 14H8.01M12 14H12.01M16 14H16.01M8 18H8.01M12 18H12.01M16 18H16.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Permanent
                  </button>
                  <button class="filter-btn" onclick="filterByEmploymentType('contract')" data-type="contract">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Contract
                  </button>
                  <button class="filter-btn" onclick="filterByEmploymentType('freelance')" data-type="freelance">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Freelance
                  </button>
                  <button class="filter-btn" onclick="filterByEmploymentType('database')" data-type="database">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <ellipse cx="12" cy="5" rx="9" ry="3" stroke="currentColor" stroke-width="2"/>
                      <path d="M21 12C21 13.66 17 15 12 15C7 15 3 13.66 3 12" stroke="currentColor" stroke-width="2"/>
                      <path d="M3 5V19C3 20.66 7 22 12 22C17 22 21 20.66 21 19V5" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Database
                  </button>
                </div>
              </div>
            </aside>

            <!-- Main Content Area -->
            <div class="career-main">
              <!-- Header with Results Count and Sort -->
              <div class="positions-header">
                <div class="header-info">
                  <span id="filter-text" class="filter-text">Filtering by: </span>
                  <span id="positions-count" class="positions-count">Showing 0 results</span>
                </div>
                <div class="sort-container">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 16V4M7 4L3 8M7 4L11 8M17 8V20M17 20L21 16M17 20L13 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span class="sort-text">Created on</span>
                </div>
              </div>

              <!-- Positions Grid -->
              <div class="positions-grid">
                <!-- Positions will be dynamically loaded here -->
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    let currentFilter = 'all';
    let allPositions = [];
    let currentLanguage = 'en';
    
    // Check if user is logged in
    function checkLoginState() {
      let userData = null;
      try {
        const stored = localStorage.getItem('vilostudios_user');
        userData = stored ? JSON.parse(stored) : null;
      } catch (e) {
        console.error('Error parsing user data from localStorage:', e);
        localStorage.removeItem('vilostudios_user');
        userData = null;
      }
      
      const userProfileNav = document.getElementById('user-profile-nav');
      const loginButton = document.getElementById('nav-login-button');
      
      if (userData && userData.email) {
        // Check for session expiration (24 hours)
        if (userData.loginTime) {
          const loginTime = new Date(userData.loginTime);
          const now = new Date();
          const hoursSinceLogin = (now - loginTime) / (1000 * 60 * 60);
          
          if (hoursSinceLogin > 24) {
            // Session expired
            localStorage.removeItem('vilostudios_user');
            if (userProfileNav) userProfileNav.style.display = 'none';
            if (loginButton) loginButton.style.display = 'flex';
            return;
          }
        }
        
        // User is logged in - show profile
        const userName = userData.name || userData.email.split('@')[0] || 'User';
        const userInitial = userName.charAt(0).toUpperCase();
        const firstName = userName.split(' ')[0];
        
        if (userProfileNav) {
          const avatar = document.getElementById('nav-user-avatar');
          const nameSpan = document.getElementById('nav-user-name');
          
          // Check if profile picture exists
          const profilePic = localStorage.getItem('vilostudios_profile_pic');
          if (avatar) {
            if (profilePic) {
              // Set profile picture as background image
              avatar.style.backgroundImage = `url(${profilePic})`;
              avatar.style.backgroundSize = 'cover';
              avatar.style.backgroundPosition = 'center';
              avatar.style.backgroundRepeat = 'no-repeat';
              avatar.textContent = '';
            } else {
              // Use initial if no profile picture
              avatar.style.backgroundImage = '';
              avatar.textContent = userInitial;
            }
          }
          
          if (nameSpan) nameSpan.textContent = firstName;
          userProfileNav.style.display = 'block';
        }
        if (loginButton) loginButton.style.display = 'none';
      } else {
        // User not logged in - show login button
        if (userProfileNav) userProfileNav.style.display = 'none';
        if (loginButton) loginButton.style.display = 'flex';
      }
    }
    
    // Demo positions from dashboard (for API bypass)
    function getExamplePositions() {
      const now = new Date();
      const futureDate1 = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
      const futureDate2 = new Date(now.getTime() + 14 * 24 * 60 * 60 * 1000);
      const futureDate3 = new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000);
      
      return [
        {
          id: 1,
          role: 'Animation Director (作画監督 / Sakkan)',
          branch: 'animation',
          jobType: 'database',
          employmentType: 'permanent',
          pay: 'USD 80000 - 120000',
          currency: 'USD',
          scheduled_date: futureDate1.toISOString(),
          start_date: new Date(futureDate1.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString(),
          end_date: null,
          description: '<p>We are looking for an experienced Animation Director to lead our animation team on various anime projects. The ideal candidate will have strong leadership skills and extensive experience in 2D animation production.</p>',
          requirements: '<ul><li>Minimum 5 years experience as Animation Director</li><li>Strong understanding of anime production pipeline</li><li>Excellent communication and leadership skills</li></ul>',
          created_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: 2,
          role: 'Key Animator (原画 / Genga)',
          branch: 'animation',
          jobType: 'database',
          employmentType: 'contract',
          pay: 'EUR 50000 - 80000',
          currency: 'EUR',
          scheduled_date: futureDate2.toISOString(),
          start_date: new Date(futureDate2.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString(),
          end_date: new Date(futureDate2.getTime() + 365 * 24 * 60 * 60 * 1000).toISOString(),
          description: '<p>Join our database of talented Key Animators. We will contact you when we have projects that match your skills and availability.</p>',
          requirements: '<ul><li>3+ years experience in key animation</li><li>Strong drawing and animation skills</li><li>Portfolio demonstrating anime-style animation</li></ul>',
          created_at: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: 3,
          role: 'Character Designer - Project: "The Adventure Quest"',
          branch: 'character-design',
          jobType: 'project',
          employmentType: 'contract',
          pay: 'JPY 7000000 - 9000000',
          currency: 'JPY',
          scheduled_date: futureDate3.toISOString(),
          start_date: new Date(futureDate3.getTime() + 1 * 24 * 60 * 60 * 1000).toISOString(),
          end_date: new Date(futureDate3.getTime() + 365 * 24 * 60 * 60 * 1000).toISOString(),
          description: '<p>Immediate opening for a Character Designer on our new fantasy adventure anime series. This is a project-specific position with a 12-month contract.</p>',
          requirements: '<ul><li>Experience in character design for anime</li><li>Ability to work within established style guides</li><li>Strong portfolio in fantasy character design</li></ul>',
          created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: 4,
          role: 'Production Coordinator',
          branch: 'production',
          jobType: 'database',
          employmentType: 'permanent',
          pay: null,
          description: '<p>We\'re looking for an organized and proactive Production Coordinator to help manage our animation projects. You\'ll work with teams across different time zones, ensuring projects stay on track.</p>',
          requirements: '<ul><li>Experience in animation or entertainment production</li><li>Excellent communication and organizational skills</li><li>Proficiency with project management tools</li><li>Ability to work with remote teams across time zones</li></ul>',
          created_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
        }
      ];
    }
    
    // Map branch to category names and icons (SVG paths)
    // Categories from anime_roles table in database
    const categoryMap = {
      'planning-production': { name: 'Planning & Production', icon: `<rect x="3" y="4" width="18" height="16" rx="2" stroke="#FF6B35" stroke-width="2"/><path d="M7 8H17M7 12H17M7 16H13" stroke="#FF6B35" stroke-width="2" stroke-linecap="round"/>` },
      'direction-story': { name: 'Direction & Story', icon: `<path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>` },
      'design-concept': { name: 'Design & Concept', icon: `<path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>` },
      'animation': { name: 'Animation', icon: `<path d="M8 5V19L19 12L8 5Z" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="3" y="5" width="4" height="14" rx="1" stroke="#FF6B35" stroke-width="2"/>` },
      'background-art-color': { name: 'Background Art & Color', icon: `<rect x="2" y="7" width="20" height="14" rx="2" stroke="#FF6B35" stroke-width="2"/><circle cx="12" cy="14" r="3" stroke="#FF6B35" stroke-width="2"/><path d="M7 3L7 7M17 3L17 7" stroke="#FF6B35" stroke-width="2" stroke-linecap="round"/>` },
      '3d-digital': { name: '3D & Digital', icon: `<rect x="3" y="3" width="18" height="18" rx="2" stroke="#FF6B35" stroke-width="2"/><path d="M3 9L12 15L21 9" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>` },
      'sound-music': { name: 'Sound & Music', icon: `<path d="M9 18V5L21 3V16" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="6" cy="18" r="3" stroke="#FF6B35" stroke-width="2"/><circle cx="18" cy="16" r="3" stroke="#FF6B35" stroke-width="2"/>` },
      'editing-post-production': { name: 'Editing & Post-Production', icon: `<rect x="3" y="4" width="18" height="16" rx="2" stroke="#FF6B35" stroke-width="2"/><path d="M8 8H16M8 12H16M8 16H12" stroke="#FF6B35" stroke-width="2" stroke-linecap="round"/>` },
      // Legacy/deprecated categories (kept for backward compatibility)
      'production': { name: 'Production', icon: `<rect x="3" y="4" width="18" height="16" rx="2" stroke="#FF6B35" stroke-width="2"/><path d="M7 8H17M7 12H17M7 16H13" stroke="#FF6B35" stroke-width="2" stroke-linecap="round"/>` },
      'character-design': { name: 'Character Design', icon: `<path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>` },
      'color-design': { name: 'Color Design', icon: `<circle cx="12" cy="12" r="10" stroke="#FF6B35" stroke-width="2"/><path d="M12 6V12L16 14" stroke="#FF6B35" stroke-width="2" stroke-linecap="round"/>` },
      'background-art': { name: 'Background Art', icon: `<path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>` },
      '3d-cgi': { name: '3D/CGI', icon: `<rect x="3" y="3" width="18" height="18" rx="2" stroke="#FF6B35" stroke-width="2"/><path d="M3 9L12 15L21 9" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>` },
      'sound': { name: 'Sound', icon: `<path d="M9 18V5L21 3V16" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="6" cy="18" r="3" stroke="#FF6B35" stroke-width="2"/><circle cx="18" cy="16" r="3" stroke="#FF6B35" stroke-width="2"/>` },
      'editing': { name: 'Editing', icon: `<rect x="3" y="4" width="18" height="16" rx="2" stroke="#FF6B35" stroke-width="2"/><path d="M8 8H16M8 12H16M8 16H12" stroke="#FF6B35" stroke-width="2" stroke-linecap="round"/>` },
      'photography-compositing': { name: 'Photography & Compositing', icon: `<rect x="2" y="7" width="20" height="14" rx="2" stroke="#FF6B35" stroke-width="2"/><circle cx="12" cy="14" r="3" stroke="#FF6B35" stroke-width="2"/><path d="M7 3L7 7M17 3L17 7" stroke="#FF6B35" stroke-width="2" stroke-linecap="round"/>` }
    };
    
    // Get language from LanguageManager or fallback to URL/localStorage
    function getLanguage() {
      // First, try to get from LanguageManager (synced with site-wide language switcher)
      if (typeof window.LanguageManager !== 'undefined' && window.LanguageManager.getCurrentLanguage) {
        const lang = window.LanguageManager.getCurrentLanguage();
        if (lang && ['en', 'ja', 'zh'].includes(lang)) {
          return lang;
        }
      }
      
      // Fallback to URL parameter
      const urlParams = new URLSearchParams(window.location.search);
      const langParam = urlParams.get('lang');
      if (langParam && ['en', 'ja', 'zh'].includes(langParam)) {
        return langParam;
      }
      
      // Fallback to localStorage
      const storedLang = localStorage.getItem('vilostudios-language') || localStorage.getItem('preferred_language') || 'en';
      return ['en', 'ja', 'zh'].includes(storedLang) ? storedLang : 'en';
    }
    
    // Load positions from API or use demo data
    async function loadPositions() {
      const language = getLanguage();
      currentLanguage = language;
      const listingsContainer = document.querySelector('.positions-grid');
      const apiBypass = localStorage.getItem('vilostudios_api_bypass') === 'true';
      
      if (!listingsContainer) {
        console.error('Positions grid container not found');
        return;
      }
      
      // Use demo data if API bypass is on (check BEFORE any async operations)
      if (apiBypass) {
        allPositions = getExamplePositions();
        loadDepartments();
        initializeFilters();
        applyFilters();
        return;
      }
      
      // Show loading state only if API bypass is off
      try {
        listingsContainer.innerHTML = '<div style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.5); grid-column: 1 / -1;">Loading positions...</div>';
        
        // Fetch from API
        const response = await fetch(`api/jobs/list.php?lang=${language}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          allPositions = result.data;
          loadDepartments();
          initializeFilters();
          applyFilters();
        } else {
          listingsContainer.innerHTML = '<div style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.5); grid-column: 1 / -1;">No positions available at this time.</div>';
        }
      } catch (error) {
        console.error('Error loading positions:', error);
        // Fallback to demo data on error
        allPositions = getExamplePositions();
        loadDepartments();
        initializeFilters();
        applyFilters();
      }
    }
    
    // Handle language switching
    function setupLanguageSwitcher() {
      const langButtons = document.querySelectorAll('.lang-button');
      langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const lang = btn.dataset.lang;
          currentLanguage = lang;
          
          // Update LanguageManager if available (syncs with site-wide language)
          if (typeof window.LanguageManager !== 'undefined' && window.LanguageManager.setLanguage) {
            window.LanguageManager.setLanguage(lang);
          }
          
          // Update active state
          langButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          // Store preference (both for compatibility)
          localStorage.setItem('vilostudios-language', lang);
          localStorage.setItem('preferred_language', lang);
          
          // Update URL without reload
          const url = new URL(window.location);
          url.searchParams.set('lang', lang);
          window.history.pushState({}, '', url);
          
          // Reload positions with new language
          loadPositions();
        });
      });
      
      // Set initial active language based on LanguageManager or getLanguage()
      const currentLang = getLanguage();
      langButtons.forEach(btn => {
        if (btn.dataset.lang === currentLang) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      // Listen for language changes from LanguageManager (when changed elsewhere on site)
      if (typeof window.LanguageManager !== 'undefined') {
        // Create a custom event listener for language changes
        const originalSetLanguage = window.LanguageManager.setLanguage;
        if (originalSetLanguage) {
          window.LanguageManager.setLanguage = function(lang) {
            originalSetLanguage.call(this, lang);
            // Update career page language if on career page
            if (window.location.pathname.includes('career.html') || window.location.pathname.includes('career')) {
              currentLanguage = lang;
              loadPositions();
              // Update button states
              langButtons.forEach(btn => {
                if (btn.dataset.lang === lang) {
                  btn.classList.add('active');
                } else {
                  btn.classList.remove('active');
                }
              });
            }
          };
        }
      }
    }
    
    // Initialize filter buttons
    function initializeFilters() {
      // Set default active employment filter
      document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.dataset.type === 'all') {
          btn.classList.add('active');
        }
      });
      
      // Set default filter text
      updateFilterText();
    }
    
    // Load departments from database
    async function loadDepartments() {
      const apiBypass = localStorage.getItem('vilostudios_api_bypass') === 'true';
      
      if (apiBypass) {
        // Use categoryMap for demo data
        renderCategoriesFromPositions();
        return;
      }
      
      try {
        const response = await fetch('api/jobs/departments.php');
        const result = await response.json();
        
        if (result.success && result.data) {
          // Store department counts from database
          window.departmentCounts = {};
          result.data.forEach(dept => {
            window.departmentCounts[dept.branch] = parseInt(dept.count);
          });
          
          // Render categories using database departments
          renderCategoriesFromDatabase(result.data);
        } else {
          // Fallback to position-based categories
          renderCategoriesFromPositions();
        }
      } catch (error) {
        console.error('Error loading departments:', error);
        // Fallback to position-based categories
        renderCategoriesFromPositions();
      }
    }
    
    // Render categories from database departments
    function renderCategoriesFromDatabase(departments) {
      const categoriesContainer = document.querySelector('.job-categories-container');
      if (!categoriesContainer) return;
      
      // Create category cards from database departments
      let categoriesHTML = '';
      departments.forEach(dept => {
        const branch = dept.branch;
        const category = categoryMap[branch] || { 
          name: branch.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '), 
          icon: '<path d="M12 2L2 7L12 12L22 7L12 2ZM2 17L12 22L22 17ZM2 12L12 17L22 12" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>' 
        };
        const count = parseInt(dept.count) || 0;
        const isActive = currentFilter === branch;
        categoriesHTML += `
          <div class="job-category-card ${isActive ? 'active' : ''}" onclick="filterJobs('${branch}')">
            <div class="category-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                ${category.icon}
              </svg>
            </div>
            <div style="flex: 1; min-width: 0;">
              <div class="category-name">${category.name}</div>
              <div class="job-count" data-category="${branch}">${count} position${count !== 1 ? 's' : ''}</div>
            </div>
          </div>
        `;
      });
      
      categoriesContainer.innerHTML = categoriesHTML;
    }
    
    // Render categories from positions (fallback/demo)
    function renderCategoriesFromPositions() {
      const categoriesContainer = document.querySelector('.job-categories-container');
      if (!categoriesContainer) return;
      
      // Count positions per category
      const categoryCounts = {};
      allPositions.forEach(pos => {
        const branch = pos.branch || pos.department;
        if (!categoryCounts[branch]) {
          categoryCounts[branch] = 0;
        }
        categoryCounts[branch]++;
      });
      
      // Create category cards
      let categoriesHTML = '';
      Object.keys(categoryCounts).forEach(branch => {
        const category = categoryMap[branch] || { 
          name: branch.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '), 
          icon: '<path d="M12 2L2 7L12 12L22 7L12 2ZM2 17L12 22L22 17ZM2 12L12 17L22 12" stroke="#FF6B35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>' 
        };
        const count = categoryCounts[branch];
        const isActive = currentFilter === branch;
        categoriesHTML += `
          <div class="job-category-card ${isActive ? 'active' : ''}" onclick="filterJobs('${branch}')">
            <div class="category-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                ${category.icon}
              </svg>
            </div>
            <div style="flex: 1; min-width: 0;">
              <div class="category-name">${category.name}</div>
              <div class="job-count" data-category="${branch}">${count} position${count !== 1 ? 's' : ''}</div>
            </div>
          </div>
        `;
      });
      
      categoriesContainer.innerHTML = categoriesHTML;
    }
    
    // Legacy function name for compatibility
    function renderCategories() {
      loadDepartments();
    }
    
    function getCategoryDescription(branch) {
      const descriptions = {
        // Main categories from database
        'planning-production': 'Planning, Production & Project Management',
        'direction-story': 'Direction, Storyboarding & Script Writing',
        'design-concept': 'Character, Concept & Visual Design',
        'animation': '2D & 3D Animation roles',
        'background-art-color': 'Background Art, Color Design & Finishing',
        '3d-digital': '3D/CG & Digital Production',
        'sound-music': 'Sound Design, Music & Audio Production',
        'editing-post-production': 'Editing & Post-Production',
        // Legacy/deprecated categories (kept for backward compatibility)
        'production': 'Production & Project Management',
        'character-design': 'Character Design & Development',
        'color-design': 'Color Design & Finishing',
        'background-art': 'Background Art & Environments',
        '3d-cgi': '3D/CGI Production',
        'sound': 'Sound Design & Music',
        'editing': 'Editing & Post-Production',
        'photography-compositing': 'Photography & Compositing',
        'technology': 'Technology & Development',
        'internal-management': 'Internal Management',
        'development': 'Development & Engineering'
      };
      return descriptions[branch] || 'Various roles';
    }
    
    // Render positions
    function renderPositions(positions) {
      const listingsContainer = document.querySelector('.positions-grid');
      if (!listingsContainer) return;
      
      if (positions.length === 0) {
        listingsContainer.innerHTML = '<div style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.5); grid-column: 1 / -1;">No positions found in this category.</div>';
        return;
      }
      
      
      // Get category name for display
      function getCategoryName(branch) {
        return categoryMap[branch]?.name || branch.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
      }
      
      // Store positions data for detail modal
      window.positionsData = positions;
      
      // Update positions count
      const countElement = document.getElementById('positions-count');
      if (countElement) {
        countElement.textContent = `Showing ${positions.length} ${positions.length === 1 ? 'result' : 'results'}`;
      }
      
      let positionsHTML = '';
      positions.forEach(pos => {
        const branch = pos.branch || pos.department;
        const categoryName = getCategoryName(branch);
        const employmentType = pos.employmentType || 'full-time';
        const descriptionPreview = stripHtml(pos.description);
        const previewText = descriptionPreview.length > 100 ? descriptionPreview.substring(0, 100) + '...' : descriptionPreview;
        const requirementsText = stripHtml(pos.requirements);
        const hasRequirements = requirementsText && requirementsText.trim().length > 0;
        
        const applyUrl = `apply.html?id=${pos.id}&branch=${encodeURIComponent(branch)}&category=${encodeURIComponent(categoryName)}&employment=${encodeURIComponent(employmentType)}`;
        positionsHTML += `
          <a href="${applyUrl}" class="position-card-compact" data-category="${branch}" style="text-decoration: none; display: block;">
            <div class="compact-card-content">
              <div class="compact-badges">
                <span class="compact-badge badge-department">${categoryName}</span>
                <span class="compact-badge badge-employment">${employmentType.charAt(0).toUpperCase() + employmentType.slice(1).replace(/-/g, ' ')}</span>
              </div>
              <h4 class="compact-title">${pos.role || 'Position'}</h4>
              <p class="compact-preview">${previewText}</p>
              <div class="compact-footer">
                <span class="compact-location">Remote / Worldwide</span>
                <span class="compact-read-more">Apply Now →</span>
              </div>
            </div>
          </a>
        `;
      });
      
      listingsContainer.innerHTML = positionsHTML;
    }
    
    let currentEmploymentFilter = 'all';
    let currentSearchQuery = '';
    
    // Filter jobs by category
    function filterJobs(category) {
      currentFilter = category;
      const categories = document.querySelectorAll('.job-category-card');
      
      // Update active category styling
      categories.forEach(cat => {
        const onclickAttr = cat.getAttribute('onclick') || '';
        if (onclickAttr.includes(category)) {
          cat.classList.add('active');
        } else {
          cat.classList.remove('active');
        }
      });
      
      // Apply all filters
      applyFilters();
    }
    
    // Filter by employment type
    function filterByEmploymentType(type) {
      currentEmploymentFilter = type;
      
      // Update active button styling
      document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.dataset.type === type) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      // Apply all filters
      applyFilters();
    }
    
    // Handle search
    function handleSearch() {
      const searchInput = document.getElementById('position-search');
      currentSearchQuery = searchInput ? searchInput.value.toLowerCase().trim() : '';
      applyFilters();
    }
    
    // Apply all active filters
    function applyFilters() {
      let filtered = [...allPositions];
      
      // Category filter
      if (currentFilter !== 'all') {
        filtered = filtered.filter(pos => {
          const branch = pos.branch || pos.department;
          return branch === currentFilter;
        });
      }
      
      // Employment type filter
      if (currentEmploymentFilter !== 'all') {
        if (currentEmploymentFilter === 'database') {
          // Filter by jobType for database positions
          filtered = filtered.filter(pos => {
            return pos.jobType === 'database';
          });
        } else {
          filtered = filtered.filter(pos => {
            const empType = pos.employmentType || 'full-time';
            return empType === currentEmploymentFilter;
          });
        }
      }
      
      // Search filter
      if (currentSearchQuery) {
        filtered = filtered.filter(pos => {
          const role = (pos.role || '').toLowerCase();
          const description = stripHtml(pos.description || '').toLowerCase();
          const requirements = stripHtml(pos.requirements || '').toLowerCase();
          return role.includes(currentSearchQuery) || 
                 description.includes(currentSearchQuery) || 
                 requirements.includes(currentSearchQuery);
        });
      }
      
      // Update filter text
      updateFilterText();
      
      // Re-render filtered positions
      renderPositions(filtered);
    }
    
    // Update filter text in header
    function updateFilterText() {
      const filterTextEl = document.getElementById('filter-text');
      if (!filterTextEl) return;
      
      const filters = [];
      if (currentFilter !== 'all') {
        const category = categoryMap[currentFilter];
        filters.push(category ? category.name : currentFilter);
      }
      if (currentEmploymentFilter !== 'all') {
        filters.push(currentEmploymentFilter.charAt(0).toUpperCase() + currentEmploymentFilter.slice(1));
      }
      if (currentSearchQuery) {
        filters.push(`"${currentSearchQuery}"`);
      }
      
      if (filters.length > 0) {
        filterTextEl.textContent = `Filtering by: ${filters.join(', ')}`;
      } else {
        filterTextEl.textContent = 'Filtering by: ';
      }
    }
    
    function stripHtml(html) {
      if (!html) return '';
      const tmp = document.createElement('DIV');
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText || '';
    }
    
    // Open position detail modal
    function openPositionDetail(positionId, branch, categoryName, employmentType) {
      const position = window.positionsData?.find(p => p.id === positionId) || allPositions.find(p => p.id === positionId);
      if (!position) return;
      
      const descriptionPreview = stripHtml(position.description);
      const requirementsText = stripHtml(position.requirements);
      
      const modal = document.createElement('div');
      modal.className = 'position-detail-modal';
      modal.innerHTML = `
        <div class="modal-overlay" onclick="closePositionDetail()"></div>
        <div class="modal-content-detail">
          <button class="modal-close-btn" onclick="closePositionDetail()">&times;</button>
          
          <div class="modal-content-scrollable">
            <div class="detail-header">
              <div class="detail-badges">
                <span class="detail-badge badge-department">${categoryName}</span>
                <span class="detail-badge badge-employment">${employmentType.charAt(0).toUpperCase() + employmentType.slice(1).replace(/-/g, ' ')}</span>
              </div>
              <h2 class="detail-title">${position.role || 'Position'}</h2>
              <p class="detail-location">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle;">
                  <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Remote / Worldwide
              </p>
            </div>
            
            <div class="detail-body">
              <div class="detail-section">
                <h3>Description</h3>
                <div class="detail-description">${position.description || descriptionPreview}</div>
              </div>
              
              ${requirementsText ? `
              <div class="detail-section">
                <h3>Requirements</h3>
                <div class="detail-requirements">${requirementsText}</div>
              </div>
              ` : ''}
            </div>
            
            <div class="detail-apply-section">
              <div class="apply-section-header">
                <h3>Apply for this Position</h3>
                <p class="apply-section-subtitle">Fill out the form below to submit your application. We'll review it and get back to you soon.</p>
              </div>
              <form id="apply-form" class="apply-form">
                <input type="hidden" id="apply-position-id" value="${positionId}">
                <input type="hidden" id="apply-position-role" value="${position.role || 'Position'}">
                <input type="hidden" id="apply-position-department" value="${categoryName}">
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="apply-name">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Full Name *
                    </label>
                    <input type="text" id="apply-name" class="form-input" required placeholder="John Doe">
                  </div>
                  
                  <div class="form-group">
                    <label for="apply-email">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Email Address *
                    </label>
                    <input type="email" id="apply-email" class="form-input" required placeholder="your.email@example.com">
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="apply-portfolio">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <polyline points="15 3 21 3 21 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="10" y1="14" x2="21" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Portfolio URL *
                  </label>
                  <input type="url" id="apply-portfolio" class="form-input" required placeholder="https://yourportfolio.com">
                  <small>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="12" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="12" y1="8" x2="12.01" y2="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Link to your portfolio, ArtStation, or personal website
                  </small>
                </div>
                
                <div class="form-group">
                  <label for="apply-cv">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <polyline points="14 2 14 8 20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <polyline points="10 9 9 9 8 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    CV/Resume *
                  </label>
                  <div class="file-upload-wrapper" id="file-upload-area">
                    <input type="file" id="apply-cv" class="form-input file-input" accept=".pdf,.doc,.docx" required>
                    <label for="apply-cv" class="file-input-label">
                      <div class="file-upload-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </div>
                      <div class="file-upload-text">
                        <span id="file-name" class="file-name-text">Click to upload or drag and drop</span>
                        <span class="file-size-hint">PDF, DOC, DOCX (Max 10MB)</span>
                      </div>
                    </label>
                  </div>
                  <small>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="12" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="12" y1="8" x2="12.01" y2="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Accepted formats: PDF, DOC, DOCX (Max 10MB)
                  </small>
                </div>
                
                <div class="form-group">
                  <label for="apply-message">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Additional Message <span class="optional-label">(Optional)</span>
                  </label>
                  <textarea id="apply-message" class="form-input" rows="5" placeholder="Tell us why you're interested in this position, your relevant experience, or anything else you'd like us to know..."></textarea>
                  <small>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="12" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="12" y1="8" x2="12.01" y2="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    This is your chance to introduce yourself and stand out
                  </small>
                </div>
                
                <div id="apply-message-status" class="form-status"></div>
                
                <div class="form-actions">
                  <button type="submit" class="btn-primary btn-apply">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Submit Application</span>
                  </button>
                  <button type="button" class="btn-secondary" onclick="closePositionDetail()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Cancel</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Handle file input display with drag & drop
      const fileInput = document.getElementById('apply-cv');
      const fileName = document.getElementById('file-name');
      const fileUploadArea = document.getElementById('file-upload-area');
      const fileInputLabel = fileUploadArea.querySelector('.file-input-label');
      
      const updateFileDisplay = (file) => {
        if (file) {
          fileName.textContent = file.name;
          fileInputLabel.classList.add('has-file');
          // Update icon to checkmark
          const iconSvg = fileInputLabel.querySelector('.file-upload-icon svg');
          if (iconSvg) {
            iconSvg.innerHTML = '<path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>';
          }
        } else {
          fileName.textContent = 'Click to upload or drag and drop';
          fileInputLabel.classList.remove('has-file');
          // Reset icon to upload
          const iconSvg = fileInputLabel.querySelector('.file-upload-icon svg');
          if (iconSvg) {
            iconSvg.innerHTML = '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
          }
        }
      };
      
      fileInput.addEventListener('change', function(e) {
        updateFileDisplay(this.files && this.files[0] ? this.files[0] : null);
      });
      
      // Drag and drop handlers
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, preventDefaults, false);
      });
      
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      ['dragenter', 'dragover'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, () => {
          fileUploadArea.classList.add('drag-over');
        }, false);
      });
      
      ['dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, () => {
          fileUploadArea.classList.remove('drag-over');
        }, false);
      });
      
      fileUploadArea.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
          fileInput.files = files;
          updateFileDisplay(files[0]);
          // Trigger change event
          fileInput.dispatchEvent(new Event('change', { bubbles: true }));
        }
      }, false);
      
      // Handle form submission
      const form = document.getElementById('apply-form');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        await handleApplicationSubmit(positionId, position.role, categoryName);
      });
      
      // Prevent closing when clicking inside modal
      modal.querySelector('.modal-content-detail').addEventListener('click', (e) => {
        e.stopPropagation();
      });
      
      // Prevent body scroll when modal is open
      document.body.classList.add('modal-open');
      
      // Add animation
      setTimeout(() => {
        modal.querySelector('.modal-content-detail').style.transform = 'scale(1)';
        modal.querySelector('.modal-content-detail').style.opacity = '1';
      }, 10);
    }
    
    function closePositionDetail() {
      const modal = document.querySelector('.position-detail-modal');
      if (modal) {
        document.body.classList.remove('modal-open');
        modal.remove();
      }
    }
    
    // Handle application submission
    async function handleApplicationSubmit(positionId, positionRole, department) {
      const name = document.getElementById('apply-name').value.trim();
      const email = document.getElementById('apply-email').value.trim();
      const portfolio = document.getElementById('apply-portfolio').value.trim();
      const cvFile = document.getElementById('apply-cv').files[0];
      const message = document.getElementById('apply-message').value.trim();
      const statusDiv = document.getElementById('apply-message-status');
      const submitBtn = document.querySelector('.btn-apply');
      
      // Validate required fields
      if (!name) {
        statusDiv.innerHTML = '<div class="form-error">Please enter your full name</div>';
        return;
      }
      
      if (!email) {
        statusDiv.innerHTML = '<div class="form-error">Please enter your email address</div>';
        return;
      }
      
      if (!portfolio) {
        statusDiv.innerHTML = '<div class="form-error">Please enter your portfolio URL</div>';
        return;
      }
      
      if (!cvFile) {
        statusDiv.innerHTML = '<div class="form-error">Please upload your CV/Resume</div>';
        return;
      }
      
      // Convert file to base64
      const reader = new FileReader();
      reader.onload = async function(e) {
        const cvBase64 = e.target.result;
        const fileName = cvFile.name;
        
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
        statusDiv.innerHTML = '';
        
        try {
          const response = await fetch('api/applications/apply.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              position_id: positionId,
              position_role: positionRole,
              department: department,
              name: name,
              email: email,
              portfolio: portfolio,
              cv_file: cvBase64,
              cv_filename: fileName,
              message: message
            })
          });
          
          const result = await response.json();
          
          if (result.success) {
            statusDiv.innerHTML = '<div class="form-success">Application submitted successfully! We will review your application and get back to you soon.</div>';
            // Reset form
            document.getElementById('apply-form').reset();
            // Close modal after 2 seconds
            setTimeout(() => {
              closePositionDetail();
            }, 2000);
          } else {
            statusDiv.innerHTML = `<div class="form-error">Error: ${result.message || 'Failed to submit application'}</div>`;
          }
        } catch (error) {
          statusDiv.innerHTML = `<div class="form-error">Error: ${error.message}</div>`;
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Application';
        }
      };
      
      reader.readAsDataURL(cvFile);
    }
    
    // Helper function to strip HTML
    function stripHtml(html) {
      if (!html) return '';
      const tmp = document.createElement('DIV');
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText || '';
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      checkLoginState();
      
      // Listen for storage changes (when user logs in/out in another tab)
      window.addEventListener('storage', checkLoginState);
      
      setupLanguageSwitcher();
      loadPositions();
    });
  </script>
  
    <style>
      /* Dashboard Design System Styles */
      /* Career Layout - Sidebar + Main */
      .career-layout {
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: var(--spacing-3xl);
        margin-top: var(--spacing-2xl);
        align-items: start;
        padding: 0;
      }
      
      /* Sidebar */
      .career-sidebar {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-2xl);
        align-self: start;
        padding-top: 0;
        padding-right: var(--spacing-lg);
      }
      
      .career-sidebar .sidebar-section:first-child {
        margin-top: 0;
      }
      
      /* Main Content Area */
      .career-main {
        display: flex;
        flex-direction: column;
        gap: 0;
        align-self: start;
        padding-left: var(--spacing-lg);
        padding-right: var(--spacing-lg);
      }
      
      .sidebar-section {
        background: var(--bg-secondary);
        border: 1px solid var(--border-default);
        border-radius: var(--radius-lg);
        padding: var(--spacing-xl);
      }
      
      .sidebar-section:first-of-type {
        padding-top: var(--spacing-xl);
      }
      
      .sidebar-title {
        font-size: var(--font-lg);
        font-weight: 700;
        color: var(--text-primary);
        margin: 0 0 var(--spacing-xl) 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        letter-spacing: 0.02em;
      }
      
      /* Search */
      .search-container {
        position: relative;
        display: flex;
        align-items: center;
      }
      
      .search-icon {
        position: absolute;
        left: var(--spacing-md);
        color: var(--text-muted);
        pointer-events: none;
        z-index: 1;
      }
      
      .search-input {
        width: 100%;
        padding: var(--spacing-md) var(--spacing-lg) var(--spacing-md) calc(var(--spacing-md) * 2 + 20px);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-input);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: var(--font-md);
        font-family: 'Inter', sans-serif;
        transition: all var(--transition-base);
        line-height: 1.5;
      }
      
      .search-input:focus {
        outline: none;
        border-color: var(--accent-orange);
        background: var(--bg-hover);
      }
      
      .search-input::placeholder {
        color: var(--text-muted);
      }
      
      /* Category Cards in Sidebar */
      .job-categories-container {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }
      
      .job-category-card {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-default);
        border-radius: var(--radius-md);
        padding: var(--spacing-md) var(--spacing-lg);
        cursor: pointer;
        transition: all var(--transition-base);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
      }
      
      .job-category-card:hover {
        background: var(--bg-hover);
        border-color: var(--border-hover);
        transform: translateX(4px);
      }
      
      .job-category-card.active {
        background: rgba(255, 107, 53, 0.15);
        border-color: var(--accent-orange);
      }
      
      /* Employment Type Filter Buttons */
      .filter-buttons {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }
      
      .filter-btn {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md) var(--spacing-lg);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-default);
        border-radius: var(--radius-md);
        color: var(--text-secondary);
        font-size: var(--font-md);
        font-weight: 500;
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        transition: all var(--transition-base);
        text-align: left;
        line-height: 1.5;
      }
      
      .filter-btn:hover {
        background: var(--bg-hover);
        border-color: var(--border-hover);
        color: var(--text-primary);
      }
      
      .filter-btn.active {
        background: rgba(255, 107, 53, 0.15);
        border-color: var(--accent-orange);
        color: var(--accent-orange);
      }
      
      .filter-btn svg {
        stroke: currentColor;
      }
      
      .positions-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0;
        margin-bottom: var(--spacing-2xl);
        margin-top: calc(var(--spacing-xl) * -1);
        transform: translateY(calc(var(--spacing-xl) * -1));
      }
      
      .header-info {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }
      
      .filter-text {
        color: var(--text-muted);
        font-size: var(--font-md);
        line-height: 1.5;
        letter-spacing: 0.01em;
      }
      
      .positions-count {
        color: var(--text-primary);
        font-size: var(--font-md);
        font-weight: 600;
        line-height: 1.5;
        letter-spacing: 0.01em;
      }
      
      .sort-container {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        color: var(--text-secondary);
        font-size: var(--font-md);
        cursor: pointer;
        transition: color var(--transition-base);
      }
      
      .sort-container:hover {
        color: var(--text-primary);
      }
      
      .sort-text {
        font-weight: 500;
      }
      
      .category-icon {
        width: 36px;
        height: 36px;
        background: rgba(255, 107, 53, 0.15);
        border: 1px solid rgba(255, 107, 53, 0.3);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      
      
      .position-card-compact,
      a.position-card-compact {
        background: var(--bg-secondary);
        border: 1px solid var(--border-default);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        cursor: pointer;
        transition: all var(--transition-base);
        box-shadow: var(--shadow-md);
        display: flex;
        flex-direction: column;
        color: inherit;
        text-decoration: none;
      }
      
      .position-card-compact:hover,
      a.position-card-compact:hover {
        background: var(--bg-hover);
        border-color: var(--border-hover);
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        color: inherit;
        text-decoration: none;
      }
      
      .compact-card-content {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
      }
      
      .compact-badges {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
      }
      
      .compact-badge {
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        font-size: var(--font-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      
      .compact-title {
        font-size: var(--font-xl);
        font-weight: 700;
        color: var(--text-primary);
        margin: 0 0 var(--spacing-sm) 0;
        line-height: 1.4;
        letter-spacing: 0.01em;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .compact-preview {
        font-size: var(--font-base);
        color: var(--text-secondary);
        line-height: 1.6;
        margin: 0 0 var(--spacing-md) 0;
        flex: 1;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        letter-spacing: 0.01em;
      }
      
      .compact-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--border-default);
      }
      
      .compact-location {
        font-size: var(--font-sm);
        color: var(--text-muted);
      }
      
      .compact-read-more {
        font-size: var(--font-sm);
        color: var(--accent-orange);
        font-weight: 600;
      }
      
      /* Position Detail Modal */
      body.modal-open {
        overflow: hidden;
      }
      
      .position-detail-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-2xl);
        overflow: hidden;
        animation: fadeIn 0.2s ease;
      }
      
      @media (max-width: 768px) {
        .position-detail-modal {
          padding: var(--spacing-lg);
        }
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      
      .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(20px);
      }
      
      .modal-content-detail {
        position: relative;
        background: var(--bg-secondary);
        border: 1px solid var(--border-default);
        border-radius: 24px;
        max-width: 900px;
        width: 100%;
        max-height: calc(100vh - 4rem);
        overflow: hidden;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6);
        z-index: 1;
        display: flex;
        flex-direction: column;
        transform: scale(0.95);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
        margin: var(--spacing-lg);
      }
      
      @media (max-width: 768px) {
        .modal-content-detail {
          max-height: calc(100vh - 2rem);
          margin: var(--spacing-md);
        }
      }
      
      .modal-content-scrollable {
        overflow-y: auto;
        overflow-x: hidden;
        padding: var(--spacing-3xl);
        scrollbar-width: none;
        -ms-overflow-style: none;
        flex: 1;
        min-height: 0;
        box-sizing: border-box;
      }
      
      @media (max-width: 768px) {
        .modal-content-scrollable {
          padding: var(--spacing-2xl) var(--spacing-xl);
        }
        
        .modal-close-btn {
          top: var(--spacing-xl);
          right: var(--spacing-xl);
        }
      }
      
      .modal-content-scrollable::-webkit-scrollbar {
        width: 0;
        display: none;
      }
      
      .modal-content-scrollable::-webkit-scrollbar-track {
        display: none;
      }
      
      .modal-content-scrollable::-webkit-scrollbar-thumb {
        display: none;
      }
      
      .modal-close-btn {
        position: absolute;
        top: var(--spacing-2xl);
        right: var(--spacing-2xl);
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border-default);
        color: var(--text-secondary);
        font-size: 1.5rem;
        cursor: pointer;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        transition: all var(--transition-base);
        z-index: 10;
        line-height: 1;
      }
      
      @media (max-width: 768px) {
        .modal-close-btn {
          top: var(--spacing-lg);
          right: var(--spacing-lg);
        }
      }
      
      .modal-close-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--border-hover);
        color: var(--text-primary);
        transform: rotate(90deg);
      }
      
      .detail-header {
        margin-bottom: var(--spacing-2xl);
        padding-bottom: var(--spacing-xl);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        padding-top: 0;
        margin-top: 0;
        padding-left: 0;
        padding-right: 0;
      }
      
      .detail-badges {
        display: flex;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-lg);
        flex-wrap: wrap;
      }
      
      .detail-badge {
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: 8px;
        font-size: var(--font-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      
      .detail-title {
        font-size: 2.25rem;
        font-weight: 800;
        color: var(--text-primary);
        margin: 0 0 var(--spacing-md) 0;
        line-height: 1.2;
      }
      
      .detail-location {
        font-size: var(--font-md);
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
      }
      
      .detail-body {
        margin-bottom: var(--spacing-2xl);
        padding-bottom: 0;
        padding-left: 0;
        padding-right: 0;
      }
      
      .detail-section {
        margin-bottom: var(--spacing-2xl);
      }
      
      .detail-section:last-of-type {
        margin-bottom: 0;
      }
      
      .detail-section h3 {
        font-size: var(--font-xl);
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-sm);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      
      .detail-description,
      .detail-requirements {
        font-size: var(--font-md);
        line-height: 1.8;
        color: var(--text-secondary);
      }
      
      .detail-requirements {
        white-space: pre-line;
      }
      
      /* Apply Form */
      .detail-apply-section {
        border-top: 2px solid rgba(255, 255, 255, 0.1);
        padding-top: var(--spacing-2xl);
        margin-top: var(--spacing-2xl);
        padding-bottom: 0;
        padding-left: 0;
        padding-right: 0;
        background: linear-gradient(135deg, rgba(255, 107, 53, 0.03) 0%, rgba(255, 107, 53, 0.01) 100%);
        border-radius: 16px;
        padding: var(--spacing-2xl);
        margin-left: calc(var(--spacing-3xl) * -1);
        margin-right: calc(var(--spacing-3xl) * -1);
        padding-left: var(--spacing-3xl);
        padding-right: var(--spacing-3xl);
      }
      
      @media (max-width: 768px) {
        .detail-apply-section {
          margin-left: calc(var(--spacing-xl) * -1);
          margin-right: calc(var(--spacing-xl) * -1);
          padding-left: var(--spacing-xl);
          padding-right: var(--spacing-xl);
        }
      }
      
      .apply-section-header {
        margin-bottom: var(--spacing-2xl);
      }
      
      .apply-section-header h3 {
        font-size: var(--font-2xl);
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
        padding-bottom: 0;
        border-bottom: none;
      }
      
      .apply-section-subtitle {
        font-size: var(--font-sm);
        color: var(--text-secondary);
        line-height: 1.6;
        margin: 0;
      }
      
      .apply-form {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-2xl);
      }
      
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-xl);
      }
      
      @media (max-width: 640px) {
        .form-row {
          grid-template-columns: 1fr;
          gap: var(--spacing-lg);
        }
      }
      
      .apply-form .form-group {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
      }
      
      .apply-form label {
        font-size: var(--font-md);
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--spacing-xs);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }
      
      .apply-form label svg {
        color: var(--accent-orange);
        opacity: 0.8;
        flex-shrink: 0;
      }
      
      .optional-label {
        font-weight: 400;
        color: var(--text-secondary);
        font-size: 0.9em;
      }
      
      .apply-form .form-input {
        padding: var(--spacing-lg) var(--spacing-xl);
        background: rgba(255, 255, 255, 0.04);
        border: 1.5px solid var(--border-input);
        border-radius: 12px;
        color: var(--text-primary);
        font-size: var(--font-md);
        font-family: 'Inter', sans-serif;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        width: 100%;
        box-sizing: border-box;
      }
      
      .apply-form .form-input::placeholder {
        color: rgba(255, 255, 255, 0.35);
      }
      
      .apply-form .form-input:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 107, 53, 0.3);
      }
      
      .apply-form .form-input:focus {
        outline: none;
        border-color: var(--accent-orange);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }
      
      .apply-form .form-input:invalid:not(:placeholder-shown) {
        border-color: rgba(248, 113, 113, 0.5);
        background: rgba(248, 113, 113, 0.05);
      }
      
      .apply-form .form-input:valid:not(:placeholder-shown) {
        border-color: rgba(74, 222, 128, 0.5);
      }
      
      .apply-form textarea.form-input {
        resize: vertical;
        min-height: 140px;
        font-family: 'Inter', sans-serif;
        line-height: 1.6;
      }
      
      .file-upload-wrapper {
        position: relative;
      }
      
      .apply-form input[type="file"].file-input {
        position: absolute;
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        z-index: -1;
      }
      
      .file-upload-wrapper.drag-over {
        background: rgba(255, 107, 53, 0.2);
      }
      
      .file-upload-wrapper.drag-over .file-input-label {
        background: rgba(255, 107, 53, 0.2);
        border-color: var(--accent-orange);
        transform: scale(1.02);
      }
      
      .file-input-label {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-lg);
        padding: var(--spacing-2xl);
        background: rgba(255, 107, 53, 0.08);
        border: 2px dashed rgba(255, 107, 53, 0.4);
        border-radius: 12px;
        color: var(--accent-orange);
        font-weight: 600;
        font-size: var(--font-md);
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        min-height: 120px;
        flex-direction: column;
      }
      
      .file-input-label:hover {
        background: rgba(255, 107, 53, 0.12);
        border-color: rgba(255, 107, 53, 0.6);
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(255, 107, 53, 0.15);
      }
      
      .file-upload-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
        background: rgba(255, 107, 53, 0.15);
        border-radius: 12px;
        transition: all 0.2s ease;
      }
      
      .file-input-label:hover .file-upload-icon {
        background: rgba(255, 107, 53, 0.25);
        transform: scale(1.1);
      }
      
      .file-upload-icon svg {
        stroke: var(--accent-orange);
        width: 24px;
        height: 24px;
      }
      
      .file-upload-text {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-xs);
        text-align: center;
      }
      
      .file-name-text {
        font-weight: 600;
        color: var(--text-primary);
      }
      
      .file-size-hint {
        font-size: var(--font-sm);
        color: var(--text-secondary);
        font-weight: 400;
      }
      
      .file-input-label.has-file {
        background: rgba(74, 222, 128, 0.1);
        border-color: rgba(74, 222, 128, 0.4);
      }
      
      .file-input-label.has-file .file-upload-icon {
        background: rgba(74, 222, 128, 0.2);
      }
      
      .file-input-label.has-file .file-upload-icon svg {
        stroke: var(--accent-green);
      }
      
      .apply-form small {
        font-size: var(--font-sm);
        color: var(--text-muted);
        margin-top: var(--spacing-xs);
        line-height: 1.6;
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-xs);
      }
      
      .apply-form small svg {
        margin-top: 2px;
        flex-shrink: 0;
        opacity: 0.6;
      }
      
      .form-actions {
        display: flex;
        gap: var(--spacing-lg);
        margin-top: var(--spacing-2xl);
        padding-top: var(--spacing-xl);
        padding-bottom: 0;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
      }
      
      @media (max-width: 640px) {
        .form-actions {
          flex-direction: column-reverse;
        }
        
        .form-actions button {
          width: 100%;
        }
      }
      
      .btn-primary {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-lg) var(--spacing-2xl);
        font-size: var(--font-md);
        font-weight: 600;
        gap: var(--spacing-sm);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
      }
      
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
      }
      
      .btn-primary:active {
        transform: translateY(0);
      }
      
      .btn-secondary {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-lg) var(--spacing-2xl);
        background: transparent;
        color: var(--text-secondary);
        border: 1.5px solid var(--border-default);
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: var(--font-md);
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        gap: var(--spacing-sm);
      }
      
      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--border-hover);
        color: var(--text-primary);
        transform: translateY(-1px);
      }
      
      .btn-secondary:active {
        transform: translateY(0);
      }
      
      .form-status {
        margin-top: var(--spacing-md);
      }
      
      .form-success {
        padding: var(--spacing-md);
        background: rgba(74, 222, 128, 0.15);
        border: 1px solid rgba(74, 222, 128, 0.3);
        border-radius: var(--radius-md);
        color: var(--accent-green);
        font-size: var(--font-md);
      }
      
      .form-error {
        padding: var(--spacing-md);
        background: rgba(248, 113, 113, 0.15);
        border: 1px solid rgba(248, 113, 113, 0.3);
        border-radius: var(--radius-md);
        color: var(--accent-red);
        font-size: var(--font-md);
      }
      
      .position-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-md);
        gap: var(--spacing-xl);
      }
      
      .position-card-title {
        flex: 1;
        min-width: 0;
      }
      
      .position-badges {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
        margin-bottom: var(--spacing-md);
      }
      
      .position-badge {
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: var(--radius-sm);
        font-size: var(--font-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      
      .badge-department {
        background: rgba(255, 107, 53, 0.15);
        border: 1px solid rgba(255, 107, 53, 0.3);
        color: var(--accent-orange);
      }
      
      .badge-employment {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-input);
        color: var(--text-secondary);
      }
      
      .position-badge {
        display: inline-block;
      }
      
      .position-name {
        font-size: var(--font-2xl);
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--spacing-xs);
        line-height: 1.3;
      }
      
      .position-department {
        font-size: var(--font-base);
        color: var(--text-secondary);
      }
      
      .position-description {
        font-size: var(--font-md);
        line-height: 1.6;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-lg);
      }
      
      .position-requirements {
        margin-top: var(--spacing-lg);
      }
      
      .position-requirements summary {
        font-size: var(--font-base);
        font-weight: 600;
        color: var(--text-primary);
        cursor: pointer;
        list-style: none;
        padding: var(--spacing-sm) 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        transition: color var(--transition-base);
      }
      
      .position-requirements summary:hover {
        color: var(--accent-orange);
      }
      
      .position-requirements summary::-webkit-details-marker {
        display: none;
      }
      
      .position-requirements summary svg {
        transition: transform var(--transition-base);
      }
      
      .position-requirements[open] summary svg {
        transform: rotate(180deg);
      }
      
      .requirements-content {
        color: var(--text-secondary);
        font-size: var(--font-base);
        line-height: 1.6;
        white-space: pre-line;
        margin-top: var(--spacing-md);
        padding-left: var(--spacing-xl);
      }
      
      .btn-primary {
        padding: var(--spacing-sm) var(--spacing-xl);
        background: var(--accent-orange);
        color: #000;
        border: none;
        border-radius: var(--radius-md);
        font-weight: 700;
        font-size: var(--font-md);
        cursor: pointer;
        transition: all var(--transition-base);
        white-space: nowrap;
        text-decoration: none;
        display: inline-block;
      }
      
      .btn-primary:hover {
        background: var(--accent-orange-hover);
        transform: translateY(-2px);
      }
    
    @media (max-width: 1024px) {
      .section {
        padding: 3rem 2rem !important;
      }
      
      .section-title {
        font-size: 2.5rem !important;
      }
    }
    
    @media (max-width: 768px) {
      .section {
        padding: 2rem 1.5rem !important;
      }
      
      .section-title {
        font-size: 2rem !important;
      }
      
      .job-categories-container {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)) !important;
        gap: var(--spacing-md) !important;
      }
      
      .positions-grid {
        grid-template-columns: 1fr !important;
      }
      
      .modal-content-detail {
        padding: var(--spacing-xl) !important;
      }
      
      .detail-title {
        font-size: 1.5rem !important;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .btn-primary,
      .btn-secondary {
        width: 100%;
      }
    }
  </style>
  <script src="js/translations.js"></script>
  <script src="js/language.js"></script>
  <script>
    // Initialize language and sync with career page
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof window.LanguageManager !== 'undefined') {
        window.LanguageManager.currentLanguage = window.LanguageManager.detectLanguage();
        window.LanguageManager.setLanguage(window.LanguageManager.currentLanguage);
        
        // Sync career page language with LanguageManager
        const currentLang = window.LanguageManager.getCurrentLanguage();
        if (currentLang && typeof getLanguage === 'function') {
          // Update language buttons to match LanguageManager
          document.querySelectorAll('.lang-button').forEach(btn => {
            if (btn.dataset.lang === currentLang) {
              btn.classList.add('active');
            } else {
              btn.classList.remove('active');
            }
          });
          
          // Reload positions with correct language after a short delay to ensure everything is initialized
          setTimeout(() => {
            if (typeof loadPositions === 'function') {
              loadPositions();
            }
          }, 100);
        }
      }
    });
  </script>
  <script src="js/app.js"></script>
  <script src="js/video.js"></script>
</body>
</html>
