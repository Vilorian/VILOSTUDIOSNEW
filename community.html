<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="VILOSTUDIOS - Community Forum, Blog, and Patreon">
  <meta name="keywords" content="community, forum, blog, patreon, support">
  <title>Community - VILOSTUDIOS</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0f0f0f;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #252525;
      --bg-sidebar: rgba(26, 26, 26, 0.85);
      --bg-content: rgba(20, 20, 20, 0.7);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.8);
      --text-muted: rgba(255, 255, 255, 0.6);
      --accent-orange: #FF6B35;
      --accent-orange-hover: #FF8C42;
      --accent-green: #4ADE80;
      --accent-blue: #60A5FA;
      --border-default: rgba(255, 255, 255, 0.1);
      --border-hover: rgba(255, 107, 53, 0.3);
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 0.75rem;
      --spacing-lg: 1rem;
      --spacing-xl: 1.5rem;
      --spacing-2xl: 2rem;
      --spacing-3xl: 3rem;
    }
    
    /* Toast Notification System */
    .toast-container {
      position: fixed;
      top: 100px;
      right: var(--spacing-xl);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      pointer-events: none;
    }

    .toast {
      min-width: 320px;
      max-width: 420px;
      padding: var(--spacing-lg) var(--spacing-xl);
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px) saturate(180%);
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      pointer-events: auto;
      animation: toastSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .toast::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: currentColor;
      opacity: 0.6;
    }

    .toast.success {
      border-color: rgba(74, 222, 128, 0.3);
      color: #4ADE80;
    }

    .toast.success::before {
      background: #4ADE80;
    }

    .toast.error {
      border-color: rgba(248, 113, 113, 0.3);
      color: #F87171;
    }

    .toast.error::before {
      background: #F87171;
    }

    .toast.info {
      border-color: rgba(96, 165, 250, 0.3);
      color: #60A5FA;
    }

    .toast.info::before {
      background: #60A5FA;
    }

    .toast-icon {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toast-icon svg {
      width: 20px;
      height: 20px;
      stroke-width: 2.5;
    }

    .toast-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .toast-message {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      line-height: 1.5;
    }

    .toast-close {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      padding: 0;
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.15s ease;
    }

    .toast-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .toast-close svg {
      width: 16px;
      height: 16px;
    }

    @keyframes toastSlideIn {
      from {
        opacity: 0;
        transform: translateX(100%) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }

    @keyframes toastSlideOut {
      from {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateX(100%) scale(0.95);
      }
    }

    .toast.removing {
      animation: toastSlideOut 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }

    .app {
      background: var(--bg-primary);
    }

    .community-container {
      display: flex;
      min-height: 100vh;
      padding-top: 80px;
      position: relative;
      z-index: 2;
    }
    
    .community-sidebar-spacer {
      width: 280px;
      min-width: 280px;
      flex-shrink: 0;
    }
    
    /* Left Sidebar */
    .community-sidebar {
      width: 280px;
      min-width: 280px;
      background: var(--bg-sidebar);
      backdrop-filter: blur(40px) saturate(180%);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding: var(--spacing-2xl) var(--spacing-xl);
      position: fixed;
      top: 80px;
      left: 0;
      height: calc(100vh - 80px);
      overflow-y: auto;
      z-index: 10;
    }

    .sidebar-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: var(--spacing-2xl);
      color: rgba(255, 255, 255, 0.95);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-2xl);
    }
    
    .sidebar-nav-item {
      padding: var(--spacing-md) var(--spacing-lg);
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s ease;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .sidebar-nav-item:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
    }
    
    .sidebar-nav-item.active {
      background: rgba(255, 107, 53, 0.15);
      color: var(--accent-orange);
      border-left: 3px solid var(--accent-orange);
    }
    
    /* Content Area */
    .community-content {
      flex: 1;
      padding: var(--spacing-3xl) var(--spacing-3xl);
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    
    .content-section {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .content-section.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .section-header {
      margin-bottom: var(--spacing-3xl);
    }
    
    .section-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
    }
    
    .section-header p {
      font-size: 1.1rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    
    /* Forum Styles */
    .forum-categories {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--spacing-xl);
      margin-bottom: var(--spacing-3xl);
    }
    
    .forum-category-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      padding: var(--spacing-2xl);
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .forum-category-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }
    
    .forum-category-card h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
      color: var(--text-primary);
    }
    
    .forum-category-card p {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.6;
    }
    
    .forum-posts {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
    }
    
    .forum-post {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      padding: var(--spacing-2xl);
      transition: all 0.2s ease;
    }
    
    .forum-post:hover {
      border-color: var(--border-hover);
    }
    
    .forum-post-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }
    
    .forum-post-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--accent-orange);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      flex-shrink: 0;
      background-size: cover;
      background-position: center;
      border: 2px solid var(--border-default);
      position: relative;
      overflow: hidden;
    }
    
    .forum-post-avatar.has-picture {
      background: var(--bg-tertiary);
    }
    
    .forum-post-avatar.role-patreon {
      border: 2px solid var(--accent-orange);
      box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
    }
    
    .forum-post-avatar.role-staff {
      border: 2px solid var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }
    
    .forum-post-author {
      flex: 1;
    }
    
    .forum-post-author-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }
    
    .forum-post-author-role {
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    
    .forum-post-role-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: var(--spacing-xs);
    }
    
    .role-patreon {
      background: rgba(255, 107, 53, 0.2);
      color: var(--accent-orange);
      border: 1px solid rgba(255, 107, 53, 0.3);
    }
    
    .role-staff {
      background: rgba(96, 165, 250, 0.2);
      color: var(--accent-blue);
      border: 1px solid rgba(96, 165, 250, 0.3);
    }
    
    .forum-post-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
    }
    
    .forum-post-content {
      color: var(--text-secondary);
      line-height: 1.8;
      margin-bottom: var(--spacing-lg);
    }
    
    .forum-post-footer {
      display: flex;
      align-items: center;
      gap: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--border-default);
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    
    .create-post-btn {
      background: var(--accent-orange);
      color: white;
      border: none;
      padding: var(--spacing-md) var(--spacing-2xl);
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: var(--spacing-2xl);
    }
    
    .create-post-btn:hover {
      background: var(--accent-orange-hover);
      transform: translateY(-2px);
    }
    
    /* Blog Styles */
    .blog-posts {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: var(--spacing-2xl);
    }
    
    .blog-post-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .blog-post-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }
    
    .blog-post-image {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-orange-hover) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
    }
    
    .blog-post-content {
      padding: var(--spacing-2xl);
    }
    
    .blog-post-date {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: var(--spacing-sm);
    }
    
    .blog-post-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
    }
    
    .blog-post-excerpt {
      color: var(--text-secondary);
      line-height: 1.6;
    }
    
    /* Patreon Styles */
    .patreon-section {
      background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 140, 66, 0.05) 100%);
      border: 2px solid rgba(255, 107, 53, 0.3);
      border-radius: 16px;
      padding: var(--spacing-3xl);
      margin-bottom: var(--spacing-3xl);
    }
    
    .patreon-header {
      text-align: center;
      margin-bottom: var(--spacing-3xl);
    }
    
    .patreon-header h2 {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: var(--spacing-md);
      color: var(--accent-orange);
    }
    
    .patreon-benefits {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: var(--spacing-xl);
      margin-bottom: var(--spacing-3xl);
    }
    
    .patreon-benefit {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      padding: var(--spacing-xl);
    }
    
    .patreon-benefit h3 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
      color: var(--text-primary);
    }
    
    .patreon-benefit p {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.6;
    }
    
    .patreon-cta {
      text-align: center;
    }
    
    .patreon-button {
      background: var(--accent-orange);
      color: white;
      border: none;
      padding: var(--spacing-lg) var(--spacing-3xl);
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
    }
    
    .patreon-button:hover {
      background: var(--accent-orange-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
    }
    
    /* Profile Modal */
    .profile-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    
    .profile-modal.active {
      display: flex;
    }
    
    .profile-modal-content {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 16px;
      padding: var(--spacing-3xl);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .profile-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-2xl);
    }
    
    .profile-modal-header h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .close-modal {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: var(--spacing-xs);
    }
    
    .close-modal:hover {
      color: var(--text-primary);
    }
    
    .form-group {
      margin-bottom: var(--spacing-xl);
    }
    
    .form-group label {
      display: block;
      margin-bottom: var(--spacing-sm);
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-lg);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      transition: all 0.2s ease;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent-orange);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
    }
    
    .form-group input:invalid:not(:placeholder-shown),
    .form-group textarea:invalid:not(:placeholder-shown) {
      border-color: var(--accent-red);
    }
    
    .form-group input:valid:not(:placeholder-shown),
    .form-group textarea:valid:not(:placeholder-shown) {
      border-color: rgba(74, 222, 128, 0.5);
    }
    
    .field-error {
      display: block !important;
      color: var(--accent-red);
      font-size: 0.85rem;
      margin-top: var(--spacing-xs);
    }
    
    .form-error {
      padding: var(--spacing-md);
      background: rgba(248, 113, 113, 0.15);
      border: 1px solid rgba(248, 113, 113, 0.3);
      border-radius: 8px;
      color: var(--accent-red);
      font-size: 0.9rem;
    }
    
    .password-requirements .requirement {
      transition: all 0.2s ease;
    }
    
    .password-requirements .requirement.valid {
      color: var(--accent-green);
    }
    
    .password-requirements .requirement.valid .requirement-icon {
      color: var(--accent-green);
    }
    
    .password-requirements .requirement-icon {
      transition: all 0.2s ease;
    }
    
    .password-strength .strength-fill {
      transition: all 0.3s ease;
    }
    
    .password-strength .strength-fill.weak {
      width: 33%;
      background: var(--accent-red);
    }
    
    .password-strength .strength-fill.medium {
      width: 66%;
      background: #FFA500;
    }
    
    .password-strength .strength-fill.strong {
      width: 100%;
      background: var(--accent-green);
    }
    
    .avatar-upload-area:hover {
      border-color: var(--accent-orange);
      background: rgba(255, 107, 53, 0.05);
    }
    
    .avatar-upload-area.drag-over {
      border-color: var(--accent-orange);
      background: rgba(255, 107, 53, 0.1);
      transform: scale(1.02);
    }
    
    .progress-step.active .step-circle {
      background: var(--accent-orange) !important;
      border-color: var(--accent-orange) !important;
      color: white !important;
    }
    
    .progress-step.active .step-label {
      color: var(--text-primary) !important;
    }
    
    .progress-step.completed .step-circle {
      background: var(--accent-green) !important;
      border-color: var(--accent-green) !important;
      color: white !important;
    }
    
    .btn-link {
      background: none;
      border: none;
      color: var(--accent-orange);
      cursor: pointer;
      font-weight: 600;
      text-decoration: underline;
      padding: 0;
      margin-top: var(--spacing-sm);
      transition: all 0.2s ease;
    }
    
    .btn-link:hover {
      color: var(--accent-orange-hover);
    }
    
    .password-toggle:hover {
      color: var(--text-primary);
    }
    
    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .form-actions {
      display: flex;
      gap: var(--spacing-lg);
      margin-top: var(--spacing-2xl);
    }
    
    .btn-primary {
      background: var(--accent-orange);
      color: white;
      border: none;
      padding: var(--spacing-md) var(--spacing-2xl);
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      flex: 1;
    }
    
    .btn-primary:hover {
      background: var(--accent-orange-hover);
    }
    
    .btn-secondary {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-default);
      padding: var(--spacing-md) var(--spacing-2xl);
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      flex: 1;
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
    }
    
    /* Post Modal */
    .post-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    
    .post-modal.active {
      display: flex;
    }
    
    .post-modal-content {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 16px;
      padding: var(--spacing-3xl);
      max-width: 700px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    @media (max-width: 968px) {
      .community-sidebar-spacer {
        width: 0;
      }
      
      .community-sidebar {
        display: none;
      }
      
      .community-content {
        padding: var(--spacing-2xl) var(--spacing-lg);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Background Video -->
    <div class="background-video-container">
      <video class="background-video" id="video1" muted playsinline autoplay preload="auto"></video>
      <video class="background-video background-video-secondary" id="video2" muted playsinline preload="auto"></video>
      <div class="video-shader-overlay"></div>
      <div class="video-ornament-overlay">
        <svg viewBox="0 0 1920 1080" class="ornament-svg" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern id="ornamentPattern" x="0" y="0" width="200" height="200" patternUnits="userSpaceOnUse">
              <circle cx="100" cy="100" r="2" fill="#FF6B35" opacity="0.3"></circle>
              <path d="M 50 100 Q 100 50 150 100 T 250 100" stroke="#FF6B35" stroke-width="1" fill="none" opacity="0.2"></path>
            </pattern>
            <linearGradient id="ornamentGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#FF6B35" stop-opacity="0.1"></stop>
              <stop offset="50%" stop-color="#FF6B35" stop-opacity="0.05"></stop>
              <stop offset="100%" stop-color="#FF6B35" stop-opacity="0.1"></stop>
            </linearGradient>
          </defs>
          <rect width="100%" height="100%" fill="url(#ornamentPattern)" opacity="0.4"></rect>
          <path d="M 0 540 Q 480 400 960 540 T 1920 540" stroke="url(#ornamentGrad)" stroke-width="2" fill="none" opacity="0.3"></path>
          <path d="M 0 270 Q 480 130 960 270 T 1920 270" stroke="url(#ornamentGrad)" stroke-width="1.5" fill="none" opacity="0.2"></path>
          <path d="M 0 810 Q 480 670 960 810 T 1920 810" stroke="url(#ornamentGrad)" stroke-width="1.5" fill="none" opacity="0.2"></path>
        </svg>
      </div>
    </div>

    <!-- Video Footer -->
    <div class="video-footer">
      <div class="video-social-links">
        <a href="https://discord.gg/7uU4nHSFwD" target="_blank" rel="noopener noreferrer" aria-label="Discord">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"></path>
          </svg>
        </a>
        <a href="https://x.com/vilostudios" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)" id="x-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
          </svg>
        </a>
        <a href="https://www.youtube.com/@vilostudiosyt" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path>
          </svg>
        </a>
        <a href="https://www.linkedin.com/company/vilostudios" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
          </svg>
        </a>
      </div>
      <div class="video-copyright">© VILOSTUDIOS</div>
    </div>

    <!-- Navigation -->
    <nav class="navigation">
      <div class="nav-logo">
        <a href="index.html" style="display: flex; align-items: center; gap: 0.75rem; text-decoration: none; color: inherit;">
          <img src="src/Logo/BrandLogo.png" alt="VILOSTUDIOS" class="logo-img">
          <span class="logo-text">VILOSTUDIOS</span>
        </a>
      </div>
      <ul class="nav-menu">
        <li><a href="index.html#home" class="nav-link" data-section="home">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text">Home</span>
        </a></li>
        <li><a href="index.html#about" class="nav-link" data-section="about">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 5C4 3.89543 4.89543 3 6 3H10.5858C10.851 3 11.1054 3.10536 11.2929 3.29289L13.7071 5.70711C13.8946 5.89464 14.149 6 14.4142 6H18C19.1046 6 20 6.89543 20 8V19C20 20.1046 19.1046 21 18 21H6C4.89543 21 4 20.1046 4 19V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 13H16M8 17H16M8 9H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text">About</span>
        </a></li>
        <li><a href="index.html#portfolio" class="nav-link" data-section="portfolio">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 16V8C20.9996 7.64928 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64928 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3.27002 6.96L12 12.01L20.73 6.96" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 22.08V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text">Portfolio</span>
        </a></li>
        <li><a href="career.html" class="nav-link" data-section="career">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 7H4C2.89543 7 2 7.89543 2 9V19C2 20.1046 2.89543 21 4 21H20C21.1046 21 22 20.1046 22 19V9C22 7.89543 21.1046 7 20 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 21V17C16 15.8954 15.1046 15 14 15H10C8.89543 15 8 15.8954 8 17V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 11C13.1046 11 14 10.1046 14 9C14 7.89543 13.1046 7 12 7C10.8954 7 10 7.89543 10 9C10 10.1046 10.8954 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 7V5C8 3.89543 8.89543 3 10 3H14C15.1046 3 16 3.89543 16 5V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="nav-text">Career</span>
        </a></li>
      </ul>
      <div class="nav-footer">
        <div id="user-profile-nav" class="user-profile-nav" style="display: none;">
          <a href="dashboard/employee/index.html" class="nav-user-button" id="nav-user-button-link">
            <div class="nav-user-avatar" id="nav-user-avatar">U</div>
            <span class="nav-user-name" id="nav-user-name">User</span>
          </a>
        </div>
        <a href="login.html" class="nav-login-button" id="nav-login-button" title="Recruiters Login">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 5 L12 10 L7 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M12 10 L3 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
            <path d="M15 3 L17 3 C17.5523 3 18 3.44772 18 4 L18 16 C18 16.5523 17.5523 17 17 17 L15 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
          </svg>
        </a>
        <div class="language-switcher">
          <button class="lang-button active" data-lang="en" aria-label="Switch to EN">EN</button>
          <button class="lang-button" data-lang="ja" aria-label="Switch to JP">JP</button>
          <button class="lang-button" data-lang="zh" aria-label="Switch to ZH">ZH</button>
          <button class="lang-button" data-lang="ko" aria-label="Switch to KO">KO</button>
        </div>
      </div>
    </nav>

    <div class="community-container">
      <!-- Left Sidebar Spacer -->
      <div class="community-sidebar-spacer"></div>
      
      <!-- Left Sidebar -->
      <aside class="community-sidebar">
        <h2 class="sidebar-title" data-i18n="community.title">Community</h2>
        <nav class="sidebar-nav">
          <a href="#forum" class="sidebar-nav-item active" data-section="forum" data-i18n="community.forum">Forum</a>
          <a href="#blog" class="sidebar-nav-item" data-section="blog" data-i18n="community.blog">Blog</a>
          <a href="#patreon" class="sidebar-nav-item" data-section="patreon" data-i18n="community.patreon">Patreon</a>
          <a href="#profile" class="sidebar-nav-item" data-section="profile" data-i18n="community.profile.title">Profile</a>
        </nav>
      </aside>
      
      <!-- Content Area -->
      <main class="community-content">
        <!-- Forum Section -->
        <section id="forum-section" class="content-section active">
          <div class="section-header">
            <h1 data-i18n="community.forum.title">Community Forum</h1>
            <p data-i18n="community.forum.subtitle">Connect with fellow creators, share ideas, and discuss all things animation and VILOSTUDIOS.</p>
          </div>
          
          <div id="forum-content">
            <button class="create-post-btn" id="create-post-btn" data-i18n="community.forum.createPost">Create New Post</button>
            
            <div class="forum-categories" id="forum-categories">
              <div class="forum-category-card" data-category="general">
                <h3 data-i18n="community.forum.category.general">General Discussion</h3>
                <p data-i18n="community.forum.category.general.desc">General topics and discussions about animation, industry news, and more.</p>
              </div>
              <div class="forum-category-card" data-category="projects">
                <h3 data-i18n="community.forum.category.projects">Projects & Works</h3>
                <p data-i18n="community.forum.category.projects.desc">Share your work, get feedback, and showcase your animation projects.</p>
              </div>
              <div class="forum-category-card" data-category="support">
                <h3 data-i18n="community.forum.category.support">Support & Help</h3>
                <p data-i18n="community.forum.category.support.desc">Ask questions, get help, and support fellow community members.</p>
              </div>
            </div>
            
            <div class="forum-posts" id="forum-posts">
              <!-- Posts will be loaded here -->
            </div>
          </div>
        </section>
        
        <!-- Blog Section -->
        <section id="blog-section" class="content-section">
          <div class="section-header">
            <h1 data-i18n="community.blog.title">Studio Blog</h1>
            <p data-i18n="community.blog.subtitle">Latest updates, behind-the-scenes content, and news from VILOSTUDIOS.</p>
          </div>
          
          <div class="blog-posts" id="blog-posts">
            <!-- Blog posts will be loaded here -->
          </div>
        </section>
        
        <!-- Patreon Section -->
        <section id="patreon-section" class="content-section">
          <div class="section-header">
            <h1 data-i18n="community.patreon.title">Support VILOSTUDIOS</h1>
            <p data-i18n="community.patreon.subtitle">Help us create original IPs and support our team's well-being. Become a Patreon supporter and get exclusive access!</p>
          </div>
          
          <div class="patreon-section">
            <div class="patreon-header">
              <h2 data-i18n="community.patreon.header">Join Our Patreon Community</h2>
              <p data-i18n="community.patreon.header.desc">Your support helps us create original content and maintain a healthy work environment for our team.</p>
            </div>
            
            <div class="patreon-benefits">
              <div class="patreon-benefit">
                <h3 data-i18n="community.patreon.benefit.exclusive.title">Exclusive Content</h3>
                <p data-i18n="community.patreon.benefit.exclusive.desc">Get early access to behind-the-scenes content, work-in-progress animations, and exclusive updates.</p>
              </div>
              <div class="patreon-benefit">
                <h3 data-i18n="community.patreon.benefit.role.title">Patreon Supporter Role</h3>
                <p data-i18n="community.patreon.benefit.role.desc">Receive a special badge and role in the community forum, showing your support for the studio.</p>
              </div>
              <div class="patreon-benefit">
                <h3 data-i18n="community.patreon.benefit.access.title">Priority Access</h3>
                <p data-i18n="community.patreon.benefit.access.desc">Get priority access to new features, beta testing opportunities, and special events.</p>
              </div>
              <div class="patreon-benefit">
                <h3 data-i18n="community.patreon.benefit.support.title">Support Original IPs</h3>
                <p data-i18n="community.patreon.benefit.support.desc">Help us fund and create original animation projects and support our team's creative freedom.</p>
              </div>
            </div>
            
            <div class="patreon-cta">
              <a href="https://patreon.com/vilostudios" target="_blank" class="patreon-button" data-i18n="community.patreon.button">Support on Patreon</a>
            </div>
          </div>
        </section>
        
        <!-- Profile Section -->
        <section id="profile-section" class="content-section">
          <div class="section-header">
            <h1 data-i18n="community.profile.title">Your Profile</h1>
            <p data-i18n="community.profile.subtitle">Manage your profile information, avatar, and preferences.</p>
          </div>
          
          <div id="profile-content">
            <!-- Profile content will be loaded here -->
          </div>
        </section>
      </main>
    </div>
    
    <!-- Login Modal -->
    <div class="profile-modal" id="login-modal">
      <div class="profile-modal-content">
        <div class="profile-modal-header">
          <h2 data-i18n="community.login.title">Login to Community</h2>
          <button class="close-modal" id="close-login-modal">&times;</button>
        </div>
        <form id="login-form">
          <div class="form-group">
            <label for="login-identifier" data-i18n="community.login.identifier">Email or Username *</label>
            <input type="text" id="login-identifier" required placeholder="Enter your email or username">
          </div>
          <div class="form-group">
            <label for="login-password" data-i18n="community.login.password">Password *</label>
            <div style="position: relative;">
              <input type="password" id="login-password" required placeholder="Enter your password" style="padding-right: 45px;">
              <button type="button" class="password-toggle" id="toggle-login-password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 5px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="form-group" style="display: flex; align-items: center; gap: var(--spacing-sm);">
            <input type="checkbox" id="remember-me" style="width: auto;">
            <label for="remember-me" style="margin: 0; font-weight: 400;" data-i18n="community.login.remember">Remember me</label>
          </div>
          <div id="login-error" class="form-error" style="display: none; margin-bottom: var(--spacing-lg);"></div>
          <div class="form-actions">
            <button type="submit" class="btn-primary" data-i18n="community.login.submit">Login</button>
            <button type="button" class="btn-secondary" id="cancel-login" data-i18n="community.login.cancel">Cancel</button>
          </div>
          <div style="text-align: center; margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--border-default);">
            <p style="color: var(--text-muted); font-size: 0.9rem;" data-i18n="community.login.noAccount">Don't have an account?</p>
            <button type="button" class="btn-link" id="switch-to-register" data-i18n="community.login.registerLink">Create Account</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Registration Modal -->
    <div class="profile-modal" id="register-modal">
      <div class="profile-modal-content" style="max-width: 600px;">
        <div class="profile-modal-header">
          <h2 data-i18n="community.register.title">Create Account</h2>
          <button class="close-modal" id="close-register-modal">&times;</button>
        </div>
        
        <!-- Progress Indicator -->
        <div class="registration-progress" style="margin-bottom: var(--spacing-2xl);">
          <div class="progress-steps" style="display: flex; justify-content: space-between; position: relative;">
            <div class="progress-line" style="position: absolute; top: 15px; left: 0; right: 0; height: 2px; background: var(--border-default); z-index: 0;"></div>
            <div class="progress-step active" data-step="1" style="position: relative; z-index: 1; background: var(--bg-secondary); padding: 0 var(--spacing-sm);">
              <div class="step-circle" style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-orange); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; margin: 0 auto var(--spacing-xs);">1</div>
              <div class="step-label" style="font-size: 0.85rem; color: var(--text-secondary);" data-i18n="community.register.step1">Account</div>
            </div>
            <div class="progress-step" data-step="2" style="position: relative; z-index: 1; background: var(--bg-secondary); padding: 0 var(--spacing-sm);">
              <div class="step-circle" style="width: 32px; height: 32px; border-radius: 50%; background: var(--bg-tertiary); border: 2px solid var(--border-default); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 700; margin: 0 auto var(--spacing-xs);">2</div>
              <div class="step-label" style="font-size: 0.85rem; color: var(--text-muted);" data-i18n="community.register.step2">Profile</div>
            </div>
          </div>
        </div>
        
        <!-- Step 1: Account Information -->
        <form id="register-form" data-step="1">
          <div class="form-group">
            <label for="register-email" data-i18n="community.register.email">Email *</label>
            <input type="email" id="register-email" required placeholder="your.email@example.com">
            <div class="field-error" id="email-error" style="display: none; color: var(--accent-red); font-size: 0.85rem; margin-top: var(--spacing-xs);"></div>
          </div>
          
          <div class="form-group">
            <label for="register-username" data-i18n="community.register.username">Username *</label>
            <input type="text" id="register-username" required placeholder="Choose a username (3-20 characters)">
            <div class="field-error" id="username-error" style="display: none; color: var(--accent-red); font-size: 0.85rem; margin-top: var(--spacing-xs);"></div>
          </div>
          
          <div class="form-group">
            <label for="register-password" data-i18n="community.register.password">Password *</label>
            <div style="position: relative;">
              <input type="password" id="register-password" required placeholder="Create a password" style="padding-right: 45px;">
              <button type="button" class="password-toggle" id="toggle-register-password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 5px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="password-requirements" id="password-requirements" style="margin-top: var(--spacing-sm); padding: var(--spacing-md); background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
              <div class="requirement" data-requirement="length" style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-xs); font-size: 0.85rem;">
                <span class="requirement-icon" style="width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">✗</span>
                <span data-i18n="community.register.passwordReq.length">At least 8 characters</span>
              </div>
              <div class="requirement" data-requirement="upper" style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-xs); font-size: 0.85rem;">
                <span class="requirement-icon" style="width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">✗</span>
                <span data-i18n="community.register.passwordReq.upper">One uppercase letter</span>
              </div>
              <div class="requirement" data-requirement="lower" style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-xs); font-size: 0.85rem;">
                <span class="requirement-icon" style="width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">✗</span>
                <span data-i18n="community.register.passwordReq.lower">One lowercase letter</span>
              </div>
              <div class="requirement" data-requirement="number" style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.85rem;">
                <span class="requirement-icon" style="width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">✗</span>
                <span data-i18n="community.register.passwordReq.number">One number</span>
              </div>
            </div>
            <div class="password-strength" id="password-strength" style="margin-top: var(--spacing-sm);">
              <div class="strength-bar" style="height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden;">
                <div class="strength-fill" style="height: 100%; width: 0%; transition: all 0.3s ease; border-radius: 2px;"></div>
              </div>
              <div class="strength-text" style="margin-top: var(--spacing-xs); font-size: 0.85rem; color: var(--text-muted);"></div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="register-password-confirm" data-i18n="community.register.passwordConfirm">Confirm Password *</label>
            <div style="position: relative;">
              <input type="password" id="register-password-confirm" required placeholder="Confirm your password" style="padding-right: 45px;">
              <button type="button" class="password-toggle" id="toggle-register-password-confirm" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 5px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="field-error" id="password-confirm-error" style="display: none; color: var(--accent-red); font-size: 0.85rem; margin-top: var(--spacing-xs);"></div>
          </div>
          
          <div id="register-error" class="form-error" style="display: none; margin-bottom: var(--spacing-lg);"></div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="cancel-register" data-i18n="community.register.cancel">Cancel</button>
            <button type="button" class="btn-primary" id="next-step-btn" data-i18n="community.register.next">Next Step</button>
          </div>
        </form>
        
        <!-- Step 2: Profile Information -->
        <form id="register-profile-form" data-step="2" style="display: none;">
          <div class="form-group">
            <label data-i18n="community.register.profilePicture">Profile Picture</label>
            <div class="avatar-upload-area" id="avatar-upload-area" style="border: 2px dashed var(--border-default); border-radius: 12px; padding: var(--spacing-2xl); text-align: center; cursor: pointer; transition: all 0.2s ease; background: rgba(255, 255, 255, 0.02);">
              <input type="file" id="avatar-file-input" accept="image/jpeg,image/png,image/webp,image/gif" style="display: none;">
              <div id="avatar-preview-container" style="display: none; margin-bottom: var(--spacing-lg);">
                <div style="position: relative; display: inline-block;">
                  <img id="avatar-preview" src="" alt="Preview" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-orange);">
                  <button type="button" id="remove-avatar" style="position: absolute; top: -5px; right: -5px; width: 28px; height: 28px; border-radius: 50%; background: var(--accent-red); border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px;">&times;</button>
                </div>
              </div>
              <div id="avatar-upload-placeholder">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto var(--spacing-md); color: var(--accent-orange);">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);" data-i18n="community.register.avatarUpload">Click to upload or drag and drop</p>
                <p style="color: var(--text-muted); font-size: 0.85rem;" data-i18n="community.register.avatarHint">PNG, JPG, WebP or GIF (max 5MB)</p>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="register-bio" data-i18n="community.register.bio">Bio</label>
            <textarea id="register-bio" placeholder="Tell us about yourself..." rows="4"></textarea>
          </div>
          
          <div id="register-profile-error" class="form-error" style="display: none; margin-bottom: var(--spacing-lg);"></div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="back-step-btn" data-i18n="community.register.back">Back</button>
            <button type="submit" class="btn-primary" id="register-submit-btn" data-i18n="community.register.submit">Create Account</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Profile Management Modal -->
    <div class="profile-modal" id="profile-management-modal">
      <div class="profile-modal-content" style="max-width: 600px;">
        <div class="profile-modal-header">
          <h2 data-i18n="community.profile.manage">Manage Profile</h2>
          <button class="close-modal" id="close-profile-management-modal">&times;</button>
        </div>
        <div id="profile-management-content">
          <!-- Content will be loaded dynamically -->
        </div>
      </div>
    </div>
    
    <!-- Post Creation Modal -->
    <div class="post-modal" id="post-modal">
      <div class="post-modal-content">
        <div class="profile-modal-header">
          <h2 data-i18n="community.post.create">Create New Post</h2>
          <button class="close-modal" id="close-post-modal">&times;</button>
        </div>
        <form id="post-form">
          <div class="form-group">
            <label for="post-title" data-i18n="community.post.title">Title *</label>
            <input type="text" id="post-title" required placeholder="Post title">
          </div>
          <div class="form-group">
            <label for="post-category" data-i18n="community.post.category">Category *</label>
            <select id="post-category" class="form-group input" required style="width: 100%; padding: var(--spacing-md) var(--spacing-lg); background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-default); border-radius: 8px; color: var(--text-primary); font-family: 'Inter', sans-serif; font-size: 1rem;">
              <option value="general" data-i18n="community.forum.category.general">General Discussion</option>
              <option value="projects" data-i18n="community.forum.category.projects">Projects & Works</option>
              <option value="support" data-i18n="community.forum.category.support">Support & Help</option>
            </select>
          </div>
          <div class="form-group">
            <label for="post-content" data-i18n="community.post.content">Content *</label>
            <textarea id="post-content" required placeholder="Write your post here..." style="min-height: 200px;"></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary" data-i18n="community.post.submit">Submit Post</button>
            <button type="button" class="btn-secondary" id="cancel-post" data-i18n="community.post.cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="js/translations.js"></script>
  <script src="js/language.js"></script>
  <script src="js/app.js"></script>
  <script src="js/video.js"></script>
  <script src="js/navigation.js"></script>
  <script src="js/community-auth.js"></script>
  <script>
    // Community functionality
    const communityManager = {
      currentSection: 'forum',
      currentUser: null,
      userProfile: null,
      registrationStep: 1,
      avatarFile: null,
      
      async init() {
        await this.checkUserProfile();
        this.setupNavigation();
        this.setupModals();
        this.setupRegistration();
        this.setupLogin();
        this.loadForumPosts();
        this.loadBlogPosts();
        this.updateUI(); // This will show user as logged in if dashboard session was synced
      },
      
      async checkUserProfile() {
        // First check if user is logged into dashboard
        const dashboardUser = JSON.parse(localStorage.getItem('vilostudios_user') || 'null');
        const apiBypass = localStorage.getItem('vilostudios_api_bypass') === 'true';
        
        if (dashboardUser && dashboardUser.email) {
          // If API bypass is enabled, create mock community profile from dashboard data
          if (apiBypass) {
            const username = dashboardUser.email.split('@')[0];
            const dashboardRole = dashboardUser.role || 'member';
            
            // Determine community role based on dashboard role
            let communityRole = 'member';
            if (dashboardRole === 'manager' || dashboardRole === 'ambassador' || 
                dashboardRole === 'internal_recruiter' || dashboardRole === 'moderator') {
              communityRole = 'staff';
            }
            
            // Get profile picture from dashboard if available
            const dashboardProfilePic = localStorage.getItem('vilostudios_profile_pic');
            
            // Create mock community user profile
            const mockCommunityUser = {
              id: dashboardUser.id || 1,
              email: dashboardUser.email,
              username: username,
              bio: '',
              profile_picture: dashboardProfilePic || null,
              role: communityRole,
              patreon_supporter: false,
              dashboardRole: dashboardRole,
              dashboardName: dashboardUser.name || username
            };
            
            this.currentUser = mockCommunityUser;
            this.userProfile = mockCommunityUser;
            
            // Save to localStorage for persistence
            CommunityAuth.saveToLocalStorage(mockCommunityUser);
            
            this.updateUI();
            return; // User is logged in via dashboard with API bypass
          }
          
          // Try to sync dashboard session with community (when API bypass is off)
          try {
            const syncResponse = await fetch('api/community/sync_dashboard.php', {
              method: 'POST',
              credentials: 'include'
            });
            const syncData = await syncResponse.json();
            
            if (syncData.success && syncData.authenticated) {
              // Get profile picture from dashboard if available
              const dashboardProfilePic = localStorage.getItem('vilostudios_profile_pic');
              if (dashboardProfilePic && !syncData.user.profile_picture) {
                syncData.user.profile_picture = dashboardProfilePic;
              }
              
              this.currentUser = syncData.user;
              this.userProfile = syncData.user;
              this.updateUI();
              return; // User is logged in via dashboard, no need to check community session
            }
          } catch (syncError) {
            console.log('Dashboard sync failed, checking community session:', syncError);
          }
        }
        
        // Check session with API
        const user = await CommunityAuth.checkSession();
        if (user) {
          this.currentUser = user;
          this.userProfile = user;
        } else {
          // Fallback to localStorage
          const stored = CommunityAuth.loadFromLocalStorage();
          if (stored) {
            this.currentUser = stored;
            this.userProfile = stored;
          }
        }
        
        // Check if user is Patreon supporter
        const isPatreon = localStorage.getItem('vilostudios_patreon_supporter') === 'true';
        if (isPatreon && this.userProfile) {
          this.userProfile.role = 'patreon';
          this.userProfile.patreon_supporter = true;
        }
      },
      
      setupNavigation() {
        const navItems = document.querySelectorAll('.sidebar-nav-item');
        navItems.forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            const section = item.dataset.section;
            this.switchSection(section);
          });
        });
      },
      
      switchSection(section) {
        // Update active nav item
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
          item.classList.toggle('active', item.dataset.section === section);
        });
        
        // Update active content section
        document.querySelectorAll('.content-section').forEach(sec => {
          sec.classList.toggle('active', sec.id === `${section}-section`);
        });
        
        // If switching to profile section, load profile content
        if (section === 'profile') {
          this.loadProfileSection();
        }
        
        this.currentSection = section;
      },
      
      loadProfileSection() {
        const profileContent = document.getElementById('profile-content');
        if (!profileContent) return;
        
        if (!this.userProfile) {
          profileContent.innerHTML = `
            <div style="text-align: center; padding: var(--spacing-3xl);">
              <p style="color: var(--text-muted); margin-bottom: var(--spacing-xl);" data-i18n="community.profile.loginRequired">Please log in to view and manage your profile.</p>
              <button class="btn-primary" onclick="document.getElementById('login-modal').classList.add('active')" data-i18n="community.profile.loginButton">Login</button>
            </div>
          `;
          return;
        }
        
        const avatarClass = this.userProfile.profile_picture ? 'has-picture' : '';
        const avatarStyle = this.userProfile.profile_picture 
          ? `background-image: url('${this.userProfile.profile_picture}'); background-size: cover; background-position: center;`
          : '';
        const avatarText = this.userProfile.profile_picture ? '' : (this.userProfile.username || 'U').charAt(0).toUpperCase();
        const roleClass = this.userProfile.role === 'patreon' ? 'role-patreon' : this.userProfile.role === 'staff' ? 'role-staff' : '';
        
        profileContent.innerHTML = `
          <div style="max-width: 800px; margin: 0 auto;">
            <div style="background: var(--bg-secondary); border: 1px solid var(--border-default); border-radius: 16px; padding: var(--spacing-3xl);">
              <div style="display: flex; align-items: center; gap: var(--spacing-xl); margin-bottom: var(--spacing-2xl);">
                <div class="forum-post-avatar ${avatarClass} ${roleClass}" style="${avatarStyle}; width: 120px; height: 120px; font-size: 3rem;">${avatarText}</div>
                <div style="flex: 1;">
                  <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: var(--spacing-sm);">${this.userProfile.username || 'User'}</h2>
                  <p style="color: var(--text-muted); margin-bottom: var(--spacing-md);">${this.userProfile.email || ''}</p>
                  ${this.userProfile.role === 'patreon' ? '<span class="forum-post-role-badge role-patreon">Patreon Supporter</span>' : ''}
                  ${this.userProfile.role === 'staff' ? '<span class="forum-post-role-badge role-staff">Staff</span>' : ''}
                </div>
              </div>
              
              ${this.userProfile.bio ? `
                <div style="margin-bottom: var(--spacing-2xl); padding: var(--spacing-lg); background: var(--bg-tertiary); border-radius: 12px;">
                  <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: var(--spacing-sm);" data-i18n="community.profile.bio">Bio</h3>
                  <p style="color: var(--text-secondary); line-height: 1.6;">${this.userProfile.bio}</p>
                </div>
              ` : ''}
              
              <div style="display: flex; gap: var(--spacing-md);">
                <button class="btn-primary" onclick="communityManager.showProfileManagement()" data-i18n="community.profile.editButton">Edit Profile</button>
                <button class="btn-secondary" onclick="communityManager.showProfileManagement()" data-i18n="community.profile.changeAvatar">Change Avatar</button>
              </div>
            </div>
          </div>
        `;
      },
      
      setupModals() {
        // Create post button
        const createPostBtn = document.getElementById('create-post-btn');
        if (createPostBtn) {
          createPostBtn.addEventListener('click', () => {
            if (!this.userProfile) {
              // Show login modal if not logged in
              document.getElementById('login-modal').classList.add('active');
            } else {
              document.getElementById('post-modal').classList.add('active');
            }
          });
        }
        
        // Post modal
        const postModal = document.getElementById('post-modal');
        const closePostModal = document.getElementById('close-post-modal');
        const cancelPost = document.getElementById('cancel-post');
        const postForm = document.getElementById('post-form');
        
        if (closePostModal) {
          closePostModal.addEventListener('click', () => {
            postModal.classList.remove('active');
          });
        }
        
        if (cancelPost) {
          cancelPost.addEventListener('click', () => {
            postModal.classList.remove('active');
          });
        }
        
        if (postForm) {
          postForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.createPost();
          });
        }
      },
      
      setupLogin() {
        const loginModal = document.getElementById('login-modal');
        const closeLoginModal = document.getElementById('close-login-modal');
        const cancelLogin = document.getElementById('cancel-login');
        const loginForm = document.getElementById('login-form');
        const switchToRegister = document.getElementById('switch-to-register');
        const togglePassword = document.getElementById('toggle-login-password');
        
        if (closeLoginModal) {
          closeLoginModal.addEventListener('click', () => {
            loginModal.classList.remove('active');
          });
        }
        
        if (cancelLogin) {
          cancelLogin.addEventListener('click', () => {
            loginModal.classList.remove('active');
          });
        }
        
        if (switchToRegister) {
          switchToRegister.addEventListener('click', () => {
            loginModal.classList.remove('active');
            document.getElementById('register-modal').classList.add('active');
          });
        }
        
        if (togglePassword) {
          togglePassword.addEventListener('click', () => {
            const passwordInput = document.getElementById('login-password');
            passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
          });
        }
        
        if (loginForm) {
          loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleLogin();
          });
        }
      },
      
      async handleLogin() {
        const identifier = document.getElementById('login-identifier').value.trim();
        const password = document.getElementById('login-password').value;
        const rememberMe = document.getElementById('remember-me').checked;
        const errorDiv = document.getElementById('login-error');
        
        if (!identifier || !password) {
          errorDiv.textContent = 'Please fill in all fields.';
          errorDiv.style.display = 'block';
          return;
        }
        
        const result = await CommunityAuth.login(identifier, password, rememberMe);
        
        if (result.success) {
          this.currentUser = result.user;
          this.userProfile = result.user;
          document.getElementById('login-modal').classList.remove('active');
          document.getElementById('login-form').reset();
          errorDiv.style.display = 'none';
          this.updateUI();
          this.loadForumPosts();
        } else {
          errorDiv.textContent = result.message;
          errorDiv.style.display = 'block';
        }
      },
      
      setupRegistration() {
        const registerModal = document.getElementById('register-modal');
        const closeRegisterModal = document.getElementById('close-register-modal');
        const cancelRegister = document.getElementById('cancel-register');
        const registerForm = document.getElementById('register-form');
        const registerProfileForm = document.getElementById('register-profile-form');
        const nextStepBtn = document.getElementById('next-step-btn');
        const backStepBtn = document.getElementById('back-step-btn');
        const registerSubmitBtn = document.getElementById('register-submit-btn');
        const avatarFileInput = document.getElementById('avatar-file-input');
        const avatarUploadArea = document.getElementById('avatar-upload-area');
        const removeAvatarBtn = document.getElementById('remove-avatar');
        
        // Password validation
        const passwordInput = document.getElementById('register-password');
        const passwordConfirmInput = document.getElementById('register-password-confirm');
        
        if (passwordInput) {
          passwordInput.addEventListener('input', () => {
            this.validatePassword();
          });
        }
        
        if (passwordConfirmInput) {
          passwordConfirmInput.addEventListener('input', () => {
            this.validatePasswordConfirm();
          });
        }
        
        // Username validation
        const usernameInput = document.getElementById('register-username');
        if (usernameInput) {
          usernameInput.addEventListener('input', () => {
            this.validateUsername();
          });
        }
        
        // Email validation
        const emailInput = document.getElementById('register-email');
        if (emailInput) {
          emailInput.addEventListener('input', () => {
            this.validateEmail();
          });
        }
        
        // Password toggles
        const toggleRegisterPassword = document.getElementById('toggle-register-password');
        const toggleRegisterPasswordConfirm = document.getElementById('toggle-register-password-confirm');
        
        if (toggleRegisterPassword) {
          toggleRegisterPassword.addEventListener('click', () => {
            passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
          });
        }
        
        if (toggleRegisterPasswordConfirm) {
          toggleRegisterPasswordConfirm.addEventListener('click', () => {
            passwordConfirmInput.type = passwordConfirmInput.type === 'password' ? 'text' : 'password';
          });
        }
        
        // Avatar upload
        if (avatarFileInput && avatarUploadArea) {
          avatarUploadArea.addEventListener('click', () => {
            avatarFileInput.click();
          });
          
          avatarFileInput.addEventListener('change', (e) => {
            this.handleAvatarSelect(e.target.files[0]);
          });
          
          // Drag and drop
          ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            avatarUploadArea.addEventListener(eventName, (e) => {
              e.preventDefault();
              e.stopPropagation();
            });
          });
          
          ['dragenter', 'dragover'].forEach(eventName => {
            avatarUploadArea.addEventListener(eventName, () => {
              avatarUploadArea.classList.add('drag-over');
            });
          });
          
          ['dragleave', 'drop'].forEach(eventName => {
            avatarUploadArea.addEventListener(eventName, () => {
              avatarUploadArea.classList.remove('drag-over');
            });
          });
          
          avatarUploadArea.addEventListener('drop', (e) => {
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
              this.handleAvatarSelect(file);
            }
          });
        }
        
        if (removeAvatarBtn) {
          removeAvatarBtn.addEventListener('click', () => {
            this.avatarFile = null;
            document.getElementById('avatar-preview-container').style.display = 'none';
            document.getElementById('avatar-upload-placeholder').style.display = 'block';
            avatarFileInput.value = '';
          });
        }
        
        // Next step button
        if (nextStepBtn) {
          nextStepBtn.addEventListener('click', () => {
            if (this.validateStep1()) {
              this.goToStep2();
            }
          });
        }
        
        // Back step button
        if (backStepBtn) {
          backStepBtn.addEventListener('click', () => {
            this.goToStep1();
          });
        }
        
        // Register submit
        if (registerProfileForm) {
          registerProfileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleRegistration();
          });
        }
        
        // Close modals
        if (closeRegisterModal) {
          closeRegisterModal.addEventListener('click', () => {
            registerModal.classList.remove('active');
            this.resetRegistration();
          });
        }
        
        if (cancelRegister) {
          cancelRegister.addEventListener('click', () => {
            registerModal.classList.remove('active');
            this.resetRegistration();
          });
        }
      },
      
      validateStep1() {
        const email = document.getElementById('register-email').value.trim();
        const username = document.getElementById('register-username').value.trim();
        const password = document.getElementById('register-password').value;
        const passwordConfirm = document.getElementById('register-password-confirm').value;
        const errorDiv = document.getElementById('register-error');
        
        // Validate email
        if (!CommunityAuth.validateEmail(email)) {
          errorDiv.textContent = 'Please enter a valid email address.';
          errorDiv.style.display = 'block';
          return false;
        }
        
        // Validate username
        const usernameValidation = CommunityAuth.validateUsername(username);
        if (!usernameValidation.isValid) {
          errorDiv.textContent = usernameValidation.message;
          errorDiv.style.display = 'block';
          return false;
        }
        
        // Validate password
        const passwordValidation = CommunityAuth.validatePassword(password);
        if (!passwordValidation.isValid) {
          errorDiv.textContent = 'Password does not meet requirements.';
          errorDiv.style.display = 'block';
          return false;
        }
        
        // Validate password confirmation
        if (password !== passwordConfirm) {
          errorDiv.textContent = 'Passwords do not match.';
          errorDiv.style.display = 'block';
          return false;
        }
        
        errorDiv.style.display = 'none';
        return true;
      },
      
      goToStep2() {
        this.registrationStep = 2;
        document.getElementById('register-form').style.display = 'none';
        document.getElementById('register-profile-form').style.display = 'block';
        
        // Update progress indicator
        document.querySelector('.progress-step[data-step="1"]').classList.add('completed');
        document.querySelector('.progress-step[data-step="2"]').classList.add('active');
      },
      
      goToStep1() {
        this.registrationStep = 1;
        document.getElementById('register-form').style.display = 'block';
        document.getElementById('register-profile-form').style.display = 'none';
        
        // Update progress indicator
        document.querySelector('.progress-step[data-step="2"]').classList.remove('active');
        document.querySelector('.progress-step[data-step="1"]').classList.remove('completed');
      },
      
      async handleRegistration() {
        const email = document.getElementById('register-email').value.trim();
        const username = document.getElementById('register-username').value.trim();
        const password = document.getElementById('register-password').value;
        const bio = document.getElementById('register-bio').value.trim();
        const errorDiv = document.getElementById('register-profile-error');
        const submitBtn = document.getElementById('register-submit-btn');
        
        if (!this.validateStep1()) {
          this.goToStep1();
          return;
        }
        
        submitBtn.disabled = true;
        submitBtn.textContent = 'Creating Account...';
        
        const result = await CommunityAuth.register(email, username, password, bio);
        
        if (result.success) {
          // Upload avatar if selected
          if (this.avatarFile) {
            await CommunityAuth.uploadAvatar(this.avatarFile);
          }
          
          this.currentUser = result.user;
          this.userProfile = result.user;
          document.getElementById('register-modal').classList.remove('active');
          this.resetRegistration();
          this.updateUI();
          this.loadForumPosts();
        } else {
          errorDiv.textContent = result.message;
          errorDiv.style.display = 'block';
          submitBtn.disabled = false;
          submitBtn.textContent = 'Create Account';
        }
      },
      
      handleAvatarSelect(file) {
        if (!file || !file.type.startsWith('image/')) {
          return;
        }
        
        const maxSize = 5 * 1024 * 1024; // 5MB
        if (file.size > maxSize) {
          alert('File size exceeds 5MB limit.');
          return;
        }
        
        this.avatarFile = file;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById('avatar-preview').src = e.target.result;
          document.getElementById('avatar-preview-container').style.display = 'block';
          document.getElementById('avatar-upload-placeholder').style.display = 'none';
        };
        reader.readAsDataURL(file);
      },
      
      validatePassword() {
        const password = document.getElementById('register-password').value;
        const validation = CommunityAuth.validatePassword(password);
        const strength = validation.strength;
        
        // Update requirements
        document.querySelectorAll('.requirement').forEach(req => {
          const requirement = req.dataset.requirement;
          const isValid = validation.requirements[requirement === 'length' ? 'minLength' : requirement === 'upper' ? 'hasUpperCase' : requirement === 'lower' ? 'hasLowerCase' : 'hasNumber'];
          
          if (isValid) {
            req.classList.add('valid');
            req.querySelector('.requirement-icon').textContent = '✓';
          } else {
            req.classList.remove('valid');
            req.querySelector('.requirement-icon').textContent = '✗';
          }
        });
        
        // Update strength bar
        const strengthFill = document.querySelector('.strength-fill');
        const strengthText = document.querySelector('.strength-text');
        strengthFill.className = 'strength-fill ' + strength;
        
        const strengthLabels = {
          weak: 'Weak',
          medium: 'Medium',
          strong: 'Strong'
        };
        strengthText.textContent = strengthLabels[strength] || '';
      },
      
      validatePasswordConfirm() {
        const password = document.getElementById('register-password').value;
        const passwordConfirm = document.getElementById('register-password-confirm').value;
        const errorDiv = document.getElementById('password-confirm-error');
        
        if (passwordConfirm && password !== passwordConfirm) {
          errorDiv.textContent = 'Passwords do not match.';
          errorDiv.style.display = 'block';
        } else {
          errorDiv.style.display = 'none';
        }
      },
      
      validateUsername() {
        const username = document.getElementById('register-username').value.trim();
        const errorDiv = document.getElementById('username-error');
        const validation = CommunityAuth.validateUsername(username);
        
        if (!validation.isValid) {
          errorDiv.textContent = validation.message;
          errorDiv.style.display = 'block';
        } else {
          errorDiv.style.display = 'none';
        }
      },
      
      validateEmail() {
        const email = document.getElementById('register-email').value.trim();
        const errorDiv = document.getElementById('email-error');
        
        if (email && !CommunityAuth.validateEmail(email)) {
          errorDiv.textContent = 'Please enter a valid email address.';
          errorDiv.style.display = 'block';
        } else {
          errorDiv.style.display = 'none';
        }
      },
      
      resetRegistration() {
        this.registrationStep = 1;
        this.avatarFile = null;
        document.getElementById('register-form').reset();
        document.getElementById('register-profile-form').reset();
        document.getElementById('register-form').style.display = 'block';
        document.getElementById('register-profile-form').style.display = 'none';
        document.getElementById('avatar-preview-container').style.display = 'none';
        document.getElementById('avatar-upload-placeholder').style.display = 'block';
        document.getElementById('register-error').style.display = 'none';
        document.getElementById('register-profile-error').style.display = 'none';
        
        // Reset progress
        document.querySelectorAll('.progress-step').forEach(step => {
          step.classList.remove('active', 'completed');
        });
        document.querySelector('.progress-step[data-step="1"]').classList.add('active');
      },
      
      updateUI() {
        const createPostBtn = document.getElementById('create-post-btn');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const profileManageBtn = document.getElementById('profile-manage-btn');
        const userWelcome = document.getElementById('user-welcome');
        const userWelcomeName = document.getElementById('user-welcome-name');
        
        if (this.userProfile) {
          if (createPostBtn) {
            createPostBtn.textContent = 'Create New Post';
            createPostBtn.style.display = 'block';
          }
          if (loginBtn) loginBtn.style.display = 'none';
          if (logoutBtn) logoutBtn.style.display = 'block';
          if (profileManageBtn) profileManageBtn.style.display = 'block';
          if (userWelcome) {
            userWelcome.style.display = 'block';
            if (userWelcomeName) userWelcomeName.textContent = this.userProfile.username;
          }
        } else {
          if (createPostBtn) {
            createPostBtn.textContent = 'Login to Post';
            createPostBtn.style.display = 'block';
          }
          if (loginBtn) loginBtn.style.display = 'block';
          if (logoutBtn) logoutBtn.style.display = 'none';
          if (profileManageBtn) profileManageBtn.style.display = 'none';
          if (userWelcome) userWelcome.style.display = 'none';
        }
        
        // Setup button handlers
        if (loginBtn) {
          loginBtn.onclick = () => {
            document.getElementById('login-modal').classList.add('active');
          };
        }
        
        if (logoutBtn) {
          logoutBtn.onclick = async () => {
            await CommunityAuth.logout();
            this.currentUser = null;
            this.userProfile = null;
            this.updateUI();
            this.loadForumPosts();
          };
        }
        
        if (profileManageBtn) {
          profileManageBtn.onclick = () => {
            this.showProfileManagement();
          };
        }
      },
      
      showProfileManagement() {
        const modal = document.getElementById('profile-management-modal');
        const content = document.getElementById('profile-management-content');
        
        if (!this.userProfile) {
          document.getElementById('login-modal').classList.add('active');
          return;
        }
        
        content.innerHTML = `
          <form id="profile-update-form">
            <div class="form-group">
              <label data-i18n="community.profile.profilePicture">Profile Picture</label>
              <div class="avatar-upload-area" id="profile-avatar-upload-area" style="border: 2px dashed var(--border-default); border-radius: 12px; padding: var(--spacing-2xl); text-align: center; cursor: pointer; transition: all 0.2s ease; background: rgba(255, 255, 255, 0.02);">
                <input type="file" id="profile-avatar-file-input" accept="image/jpeg,image/png,image/webp,image/gif" style="display: none;">
                <div id="profile-avatar-preview-container" style="display: ${this.userProfile.profile_picture ? 'block' : 'none'}; margin-bottom: var(--spacing-lg);">
                  <div style="position: relative; display: inline-block;">
                    <img id="profile-avatar-preview" src="${this.userProfile.profile_picture || ''}" alt="Preview" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-orange);">
                    <button type="button" id="profile-remove-avatar" style="position: absolute; top: -5px; right: -5px; width: 28px; height: 28px; border-radius: 50%; background: var(--accent-red); border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px;">&times;</button>
                  </div>
                </div>
                <div id="profile-avatar-upload-placeholder" style="display: ${this.userProfile.profile_picture ? 'none' : 'block'};">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto var(--spacing-md); color: var(--accent-orange);">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);" data-i18n="community.register.avatarUpload">Click to upload or drag and drop</p>
                  <p style="color: var(--text-muted); font-size: 0.85rem;" data-i18n="community.register.avatarHint">PNG, JPG, WebP or GIF (max 5MB)</p>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="profile-update-username" data-i18n="community.profile.username">Username *</label>
              <input type="text" id="profile-update-username" value="${this.userProfile.username || ''}" required>
            </div>
            <div class="form-group">
              <label for="profile-update-bio" data-i18n="community.profile.bio">Bio</label>
              <textarea id="profile-update-bio" rows="4">${this.userProfile.bio || ''}</textarea>
            </div>
            <div id="profile-update-error" class="form-error" style="display: none; margin-bottom: var(--spacing-lg);"></div>
            <div class="form-actions">
              <button type="submit" class="btn-primary" data-i18n="community.profile.save">Save Changes</button>
              <button type="button" class="btn-secondary" id="close-profile-management">Cancel</button>
            </div>
          </form>
        `;
        
        // Setup avatar upload for profile management
        const profileAvatarInput = document.getElementById('profile-avatar-file-input');
        const profileAvatarArea = document.getElementById('profile-avatar-upload-area');
        const profileRemoveAvatar = document.getElementById('profile-remove-avatar');
        
        if (profileAvatarArea && profileAvatarInput) {
          profileAvatarArea.addEventListener('click', () => profileAvatarInput.click());
          profileAvatarInput.addEventListener('change', (e) => {
            this.handleProfileAvatarSelect(e.target.files[0]);
          });
          
          if (profileRemoveAvatar) {
            profileRemoveAvatar.addEventListener('click', async () => {
              // In production, this would call an API to remove avatar
              this.userProfile.profile_picture = null;
              this.updateUI();
              this.showProfileManagement(); // Refresh
            });
          }
        }
        
        // Setup form submission
        const profileUpdateForm = document.getElementById('profile-update-form');
        if (profileUpdateForm) {
          profileUpdateForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleProfileUpdate();
          });
        }
        
        const closeBtn = document.getElementById('close-profile-management');
        if (closeBtn) {
          closeBtn.onclick = () => {
            modal.classList.remove('active');
          };
        }
        
        const closeModalBtn = document.getElementById('close-profile-management-modal');
        if (closeModalBtn) {
          closeModalBtn.onclick = () => {
            modal.classList.remove('active');
          };
        }
        
        modal.classList.add('active');
      },
      
      async handleProfileAvatarSelect(file) {
        if (!file || !file.type.startsWith('image/')) {
          return;
        }
        
        const result = await CommunityAuth.uploadAvatar(file);
        if (result.success) {
          this.userProfile.profile_picture = result.image_url;
          this.updateUI();
          this.showProfileManagement(); // Refresh to show new avatar
        } else {
          alert(result.message);
        }
      },
      
      async handleProfileUpdate() {
        const username = document.getElementById('profile-update-username').value.trim();
        const bio = document.getElementById('profile-update-bio').value.trim();
        const errorDiv = document.getElementById('profile-update-error');
        const submitBtn = document.querySelector('#profile-update-form .btn-primary');
        
        const result = await CommunityAuth.updateProfile(username, bio);
        
        if (result.success) {
          this.currentUser = result.user;
          this.userProfile = result.user;
          document.getElementById('profile-management-modal').classList.remove('active');
          this.updateUI();
          this.loadForumPosts();
        } else {
          errorDiv.textContent = result.message;
          errorDiv.style.display = 'block';
        }
      },
      
      updateSidebarAuth() {
        // Add login/logout button to sidebar if needed
        // This can be enhanced later
      },
      
      async createPost() {
        if (!this.userProfile) {
          document.getElementById('post-modal').classList.remove('active');
          document.getElementById('login-modal').classList.add('active');
          return;
        }
        
        const title = document.getElementById('post-title').value.trim();
        const category = document.getElementById('post-category').value;
        const content = document.getElementById('post-content').value.trim();
        
        if (!title || !content) {
          this.showNotification('Please fill in all required fields', 'error');
          return;
        }
        
        const post = {
          id: Date.now(),
          title: title,
          category: category,
          content: content,
          author: this.userProfile.username,
          authorId: this.userProfile.id,
          authorRole: this.userProfile.role || 'member',
          authorAvatar: this.userProfile.profile_picture || null,
          createdAt: new Date().toISOString(),
          replies: 0,
          views: 0
        };
        
        // Save to localStorage (in production, this would be an API call)
        const posts = JSON.parse(localStorage.getItem('vilostudios_forum_posts') || '[]');
        posts.unshift(post);
        localStorage.setItem('vilostudios_forum_posts', JSON.stringify(posts));
        
        document.getElementById('post-modal').classList.remove('active');
        document.getElementById('post-form').reset();
        
        this.showNotification('Post created successfully!', 'success');
        this.loadForumPosts();
      },
      
      loadForumPosts() {
        const posts = JSON.parse(localStorage.getItem('vilostudios_forum_posts') || '[]');
        const postsContainer = document.getElementById('forum-posts');
        
        if (posts.length === 0) {
          postsContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: var(--spacing-3xl);">No posts yet. Be the first to post!</p>';
          return;
        }
        
        postsContainer.innerHTML = posts.map(post => {
          const avatarClass = post.authorAvatar ? 'has-picture' : '';
          const roleClass = post.authorRole === 'patreon' ? 'role-patreon' : post.authorRole === 'staff' ? 'role-staff' : '';
          const avatarStyle = post.authorAvatar 
            ? `background-image: url('${post.authorAvatar}'); background-size: cover; background-position: center;`
            : '';
          const avatarText = post.authorAvatar ? '' : post.author.charAt(0).toUpperCase();
          
          const isModerator = this.currentUser && (this.currentUser.role === 'staff' || this.currentUser.role === 'moderator');
          const canModerate = isModerator || (this.currentUser && this.currentUser.dashboardRole === 'moderator' || this.currentUser.dashboardRole === 'manager');
          
          // Get user's vote for this post
          const userId = this.userProfile?.id;
          const userVote = post.votes && userId ? (post.votes[userId] || 0) : 0;
          const score = post.score || 0;
          
          return `
          <div class="forum-post" data-post-id="${post.id || post.postId || ''}">
            <div class="forum-post-header">
              <div class="forum-post-avatar ${avatarClass} ${roleClass}" style="${avatarStyle}">${avatarText}</div>
              <div class="forum-post-author">
                <div class="forum-post-author-name">
                  ${post.author}
                  ${post.authorRole === 'patreon' ? '<span class="forum-post-role-badge role-patreon">Patreon</span>' : ''}
                  ${post.authorRole === 'staff' ? '<span class="forum-post-role-badge role-staff">Staff</span>' : ''}
                </div>
                <div class="forum-post-author-role">${this.formatDate(post.createdAt)}</div>
              </div>
              ${canModerate ? `
                <div class="forum-post-moderation" style="display: flex; gap: var(--spacing-sm); margin-left: auto;">
                  <button class="mod-action-btn remove-post-btn" data-post-id="${post.id || post.postId || ''}" title="Remove Post" style="padding: var(--spacing-xs) var(--spacing-sm); background: rgba(239, 68, 68, 0.15); color: #EF4444; border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; cursor: pointer; font-size: 0.75rem;">
                    Remove
                  </button>
                  <button class="mod-action-btn wipe-post-btn" data-post-id="${post.id || post.postId || ''}" title="Wipe Post (Permanent Delete)" style="padding: var(--spacing-xs) var(--spacing-sm); background: rgba(127, 29, 29, 0.15); color: #DC2626; border: 1px solid rgba(127, 29, 29, 0.3); border-radius: 6px; cursor: pointer; font-size: 0.75rem;">
                    Wipe
                  </button>
                </div>
              ` : ''}
            </div>
            <div style="display: flex; gap: var(--spacing-lg);">
              <div class="forum-vote-container">
                <button class="forum-vote-btn upvote-btn ${userVote === 1 ? 'upvoted' : ''}" data-post-id="${post.id}" data-vote="1" title="Upvote">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 15l-6-6-6 6"></path>
                  </svg>
                </button>
                <div class="forum-vote-count">${score}</div>
                <button class="forum-vote-btn downvote-btn ${userVote === -1 ? 'downvoted' : ''}" data-post-id="${post.id}" data-vote="-1" title="Downvote">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 9l6 6 6-6"></path>
                  </svg>
                </button>
              </div>
              <div style="flex: 1;">
                <h3 class="forum-post-title" style="cursor: pointer;" onclick="communityManager.togglePostExpanded(${post.id})">${post.title}</h3>
                <div class="forum-post-content">${post.content}</div>
                <div class="forum-post-footer">
                  <div class="forum-post-actions">
                    <button class="forum-action-btn reply-btn" data-post-id="${post.id}" title="Reply">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                      </svg>
                      <span>Reply</span>
                    </button>
                    <span>Category: ${post.category}</span>
                    <span>${post.replies || 0} comments</span>
                    <span>${post.views || 0} views</span>
                  </div>
                </div>
                <div class="forum-comments-section" id="comments-${post.id}" style="display: ${post.expanded ? 'block' : 'none'};">
                  <div class="forum-comments-header">${post.replies || 0} Comments</div>
                  <div class="forum-comments-list" id="comments-list-${post.id}">
                    ${this.renderComments(post.id, post.comments || [])}
                  </div>
                  ${this.userProfile ? `
                    <div class="forum-reply-form" id="reply-form-${post.id}">
                      <textarea placeholder="Write a comment..." id="reply-content-${post.id}"></textarea>
                      <div class="forum-reply-form-actions">
                        <button class="forum-reply-cancel" onclick="communityManager.cancelReply(${post.id})">Cancel</button>
                        <button class="forum-reply-submit" onclick="communityManager.submitReply(${post.id}, null)">Comment</button>
                      </div>
                    </div>
                  ` : ''}
                </div>
              </div>
            </div>
          </div>
        `;
        }).join('');
        
        // Setup moderation handlers after rendering
        this.setupModerationHandlers();
        
        // Setup vote handlers
        document.querySelectorAll('.upvote-btn, .downvote-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const postId = parseInt(btn.dataset.postId);
            const vote = parseInt(btn.dataset.vote);
            this.handleVote(postId, vote);
          });
        });
        
        // Setup reply button handlers
        document.querySelectorAll('.reply-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const postId = parseInt(btn.dataset.postId);
            this.showReplyForm(postId);
          });
        });
      },
      
      loadBlogPosts() {
        const posts = JSON.parse(localStorage.getItem('vilostudios_blog_posts') || '[]');
        const postsContainer = document.getElementById('blog-posts');
        
        if (posts.length === 0) {
          postsContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: var(--spacing-3xl);">No blog posts yet. Check back soon!</p>';
          return;
        }
        
        postsContainer.innerHTML = posts.map(post => `
          <div class="blog-post-card">
            <div class="blog-post-image">📝</div>
            <div class="blog-post-content">
              <div class="blog-post-date">${this.formatDate(post.createdAt)}</div>
              <h3 class="blog-post-title">${post.title}</h3>
              <p class="blog-post-excerpt">${post.excerpt || post.content.substring(0, 150) + '...'}</p>
            </div>
          </div>
        `).join('');
      },
      
      formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      },
      
      setupModerationHandlers() {
        // Remove post handler
        document.querySelectorAll('.remove-post-btn').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            e.stopPropagation();
            const postId = btn.dataset.postId;
            if (!postId) return;
            
            if (!confirm('Remove this post? It will be hidden from view but not permanently deleted.')) {
              return;
            }
            
            await this.removePost(postId, false);
          });
        });
        
        // Wipe post handler
        document.querySelectorAll('.wipe-post-btn').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            e.stopPropagation();
            const postId = btn.dataset.postId;
            if (!postId) return;
            
            if (!confirm('WARNING: This will permanently delete this post and all its comments. This cannot be undone!\n\nAre you sure?')) {
              return;
            }
            
            if (!confirm('Final confirmation: Permanently delete this post?')) {
              return;
            }
            
            await this.removePost(postId, true);
          });
        });
      },
      
      async removePost(postId, wipe = false) {
        try {
          const response = await fetch('api/community/remove_post.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify({
              id: postId,
              wipe: wipe
            })
          });
          
          const result = await response.json();
          
          if (result.success) {
            this.showNotification(result.message, 'success');
            this.loadForumPosts();
          } else {
            this.showNotification(result.message || 'Failed to remove post', 'error');
          }
        } catch (error) {
          console.error('Error removing post:', error);
          this.showNotification('Error removing post', 'error');
        }
      },
      
      renderComments(postId, comments) {
        if (!comments || comments.length === 0) {
          return '<p style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: var(--spacing-xl);">No comments yet. Be the first to comment!</p>';
        }
        
        return comments.map(comment => {
          const avatarClass = comment.authorAvatar ? 'has-picture' : '';
          const avatarStyle = comment.authorAvatar 
            ? `background-image: url('${comment.authorAvatar}'); background-size: cover; background-position: center;`
            : '';
          const avatarText = comment.authorAvatar ? '' : (comment.author || 'U').charAt(0).toUpperCase();
          const roleClass = comment.authorRole === 'patreon' ? 'role-patreon' : comment.authorRole === 'staff' ? 'role-staff' : '';
          
          return `
            <div class="forum-comment" data-comment-id="${comment.id}">
              <div class="forum-comment-header">
                <div class="forum-comment-avatar ${avatarClass} ${roleClass}" style="${avatarStyle}">${avatarText}</div>
                <div class="forum-comment-author">
                  <div class="forum-comment-author-name">
                    ${comment.author}
                    ${comment.authorRole === 'patreon' ? '<span class="forum-post-role-badge role-patreon">Patreon</span>' : ''}
                    ${comment.authorRole === 'staff' ? '<span class="forum-post-role-badge role-staff">Staff</span>' : ''}
                  </div>
                  <div class="forum-comment-meta">${this.formatDate(comment.createdAt)}</div>
                </div>
              </div>
              <div class="forum-comment-content">${comment.content}</div>
              <div class="forum-comment-actions">
                <button class="forum-comment-reply-btn" onclick="communityManager.showReplyForm(${postId}, ${comment.id})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                  </svg>
                  Reply
                </button>
              </div>
              ${comment.replies && comment.replies.length > 0 ? `
                <div class="forum-comment-replies">
                  ${this.renderComments(postId, comment.replies)}
                </div>
              ` : ''}
              <div class="forum-reply-form" id="reply-form-${postId}-${comment.id}" style="display: none;">
                <textarea placeholder="Write a reply..." id="reply-content-${postId}-${comment.id}"></textarea>
                <div class="forum-reply-form-actions">
                  <button class="forum-reply-cancel" onclick="communityManager.cancelReply(${postId}, ${comment.id})">Cancel</button>
                  <button class="forum-reply-submit" onclick="communityManager.submitReply(${postId}, ${comment.id})">Reply</button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      },
      
      togglePostExpanded(postId) {
        const commentsSection = document.getElementById(`comments-${postId}`);
        if (commentsSection) {
          const isExpanded = commentsSection.style.display !== 'none';
          commentsSection.style.display = isExpanded ? 'none' : 'block';
          
          // Load comments if not already loaded
          if (!isExpanded) {
            this.loadComments(postId);
          }
        }
      },
      
      loadComments(postId) {
        const posts = JSON.parse(localStorage.getItem('vilostudios_forum_posts') || '[]');
        const post = posts.find(p => p.id == postId);
        
        if (post) {
          const commentsList = document.getElementById(`comments-list-${postId}`);
          if (commentsList) {
            commentsList.innerHTML = this.renderComments(postId, post.comments || []);
          }
        }
      },
      
      showReplyForm(postId, parentCommentId = null) {
        if (!this.userProfile) {
          document.getElementById('login-modal').classList.add('active');
          return;
        }
        
        const formId = parentCommentId ? `reply-form-${postId}-${parentCommentId}` : `reply-form-${postId}`;
        const form = document.getElementById(formId);
        if (form) {
          form.classList.add('active');
          form.style.display = 'block';
          const textarea = form.querySelector('textarea');
          if (textarea) textarea.focus();
        }
      },
      
      cancelReply(postId, parentCommentId = null) {
        const formId = parentCommentId ? `reply-form-${postId}-${parentCommentId}` : `reply-form-${postId}`;
        const form = document.getElementById(formId);
        if (form) {
          form.classList.remove('active');
          form.style.display = 'none';
          const textarea = form.querySelector('textarea');
          if (textarea) textarea.value = '';
        }
      },
      
      submitReply(postId, parentCommentId = null) {
        if (!this.userProfile) {
          document.getElementById('login-modal').classList.add('active');
          return;
        }
        
        const formId = parentCommentId ? `reply-form-${postId}-${parentCommentId}` : `reply-form-${postId}`;
        const form = document.getElementById(formId);
        const textarea = form.querySelector('textarea');
        const content = textarea.value.trim();
        
        if (!content) {
          this.showNotification('Please enter a comment', 'error');
          return;
        }
        
        const comment = {
          id: Date.now(),
          postId: postId,
          parentId: parentCommentId,
          author: this.userProfile.username,
          authorId: this.userProfile.id,
          authorRole: this.userProfile.role || 'member',
          authorAvatar: this.userProfile.profile_picture || null,
          content: content,
          createdAt: new Date().toISOString(),
          replies: []
        };
        
        // Save to localStorage
        const posts = JSON.parse(localStorage.getItem('vilostudios_forum_posts') || '[]');
        const post = posts.find(p => p.id == postId);
        
        if (post) {
          if (!post.comments) post.comments = [];
          
          if (parentCommentId) {
            // Find parent comment and add reply
            const addReply = (comments) => {
              for (let c of comments) {
                if (c.id == parentCommentId) {
                  if (!c.replies) c.replies = [];
                  c.replies.push(comment);
                  return true;
                }
                if (c.replies && c.replies.length > 0) {
                  if (addReply(c.replies)) return true;
                }
              }
              return false;
            };
            addReply(post.comments);
          } else {
            post.comments.push(comment);
          }
          
          post.replies = (post.replies || 0) + 1;
          localStorage.setItem('vilostudios_forum_posts', JSON.stringify(posts));
          
          this.loadComments(postId);
          this.cancelReply(postId, parentCommentId);
          this.showNotification('Comment posted successfully!', 'success');
        }
      },
      
      handleVote(postId, vote) {
        if (!this.userProfile) {
          document.getElementById('login-modal').classList.add('active');
          return;
        }
        
        const posts = JSON.parse(localStorage.getItem('vilostudios_forum_posts') || '[]');
        const post = posts.find(p => p.id == postId);
        
        if (post) {
          if (!post.votes) post.votes = {};
          if (!post.score) post.score = 0;
          
          const userId = this.userProfile.id;
          const currentVote = post.votes[userId] || 0;
          
          // Toggle vote logic
          if (currentVote === vote) {
            // Remove vote
            delete post.votes[userId];
            post.score -= vote;
            post.userVote = 0;
          } else {
            // Change vote
            post.score = post.score - currentVote + vote;
            post.votes[userId] = vote;
            post.userVote = vote;
          }
          
          localStorage.setItem('vilostudios_forum_posts', JSON.stringify(posts));
          this.loadForumPosts();
        }
      },
      
      showNotification(message, type = 'success', duration = 4000) {
        const container = document.getElementById('toast-container');
        if (!container) {
          alert(message);
          return;
        }
        
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icons = {
          success: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>`,
          error: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>`,
          info: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>`
        };
        
        toast.innerHTML = `
          <div class="toast-icon">${icons[type] || icons.success}</div>
          <div class="toast-content">
            <div class="toast-message">${message}</div>
          </div>
          <button class="toast-close" aria-label="Close">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        `;
        
        container.appendChild(toast);
        
        const autoRemove = setTimeout(() => {
          removeToast(toast);
        }, duration);
        
        const closeBtn = toast.querySelector('.toast-close');
        closeBtn.addEventListener('click', () => {
          clearTimeout(autoRemove);
          removeToast(toast);
        });
        
        function removeToast(element) {
          element.classList.add('removing');
          setTimeout(() => {
            if (element.parentNode) {
              element.parentNode.removeChild(element);
            }
          }, 250);
        }
      }
    };
    
    // Initialize on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', async () => {
        await communityManager.init();
        // Initialize language
        if (typeof window.LanguageManager !== 'undefined') {
          window.LanguageManager.currentLanguage = window.LanguageManager.detectLanguage();
          window.LanguageManager.setLanguage(window.LanguageManager.currentLanguage);
        }
      });
    } else {
      communityManager.init();
      // Initialize language
      if (typeof window.LanguageManager !== 'undefined') {
        window.LanguageManager.currentLanguage = window.LanguageManager.detectLanguage();
        window.LanguageManager.setLanguage(window.LanguageManager.currentLanguage);
      }
    }
    
    // Listen for auth events
    window.addEventListener('auth:loggedIn', (e) => {
      communityManager.currentUser = e.detail;
      communityManager.userProfile = e.detail;
      communityManager.updateUI();
      communityManager.loadForumPosts();
    });
    
    window.addEventListener('auth:loggedOut', () => {
      communityManager.currentUser = null;
      communityManager.userProfile = null;
      communityManager.updateUI();
      communityManager.loadForumPosts();
    });
    
    window.addEventListener('auth:registered', (e) => {
      communityManager.currentUser = e.detail;
      communityManager.userProfile = e.detail;
      communityManager.updateUI();
      communityManager.loadForumPosts();
    });
    
    // Toast Notification Container
    const toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container';
    toastContainer.id = 'toast-container';
    document.body.appendChild(toastContainer);
    
    // Check login state for profile display
    function checkLoginState() {
      try {
        const stored = localStorage.getItem('vilostudios_user');
        const userProfileNav = document.getElementById('user-profile-nav');
        const navLoginButton = document.getElementById('nav-login-button');
        const navUserAvatar = document.getElementById('nav-user-avatar');
        const navUserName = document.getElementById('nav-user-name');
        const navUserButtonLink = document.getElementById('nav-user-button-link');
        
        if (!stored) {
          if (userProfileNav) userProfileNav.style.display = 'none';
          if (navLoginButton) navLoginButton.style.display = 'flex';
          return;
        }
        
        const userData = JSON.parse(stored);
        if (userData && userData.email) {
          if (userProfileNav) userProfileNav.style.display = 'flex';
          if (navLoginButton) navLoginButton.style.display = 'none';
          
          if (navUserName && userData.name) {
            const firstName = userData.name.split(' ')[0];
            navUserName.textContent = firstName;
          }
          
          if (navUserAvatar) {
            const profilePic = localStorage.getItem('vilostudios_profile_pic');
            if (profilePic) {
              navUserAvatar.style.backgroundImage = `url(${profilePic})`;
              navUserAvatar.style.backgroundSize = 'cover';
              navUserAvatar.style.backgroundPosition = 'center';
            } else {
              navUserAvatar.style.backgroundImage = 'none';
              if (userData.name) {
                navUserAvatar.textContent = userData.name.charAt(0).toUpperCase();
              }
            }
          }
        } else {
          if (userProfileNav) userProfileNav.style.display = 'none';
          if (navLoginButton) navLoginButton.style.display = 'flex';
        }
      } catch (e) {
        console.error('Error checking login state:', e);
      }
    }
    
    checkLoginState();
    window.addEventListener('storage', checkLoginState);
    
    // Language button handlers
    document.querySelectorAll('.lang-button').forEach(btn => {
      btn.addEventListener('click', () => {
        const lang = btn.dataset.lang;
        if (window.LanguageManager) {
          window.LanguageManager.setLanguage(lang);
        }
      });
    });
  </script>
</body>
</html>

